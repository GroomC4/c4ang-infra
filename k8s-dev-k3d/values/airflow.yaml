# Airflow - k3d 로컬/테스트 환경 설정
# 기본값: helm/management-base/airflow/values.yaml

airflow:
  defaultAirflowRepository: apache/airflow
  defaultAirflowTag: "2.9.0"
  defaultAirflowImagePullPolicy: IfNotPresent

  # 로컬에서는 LocalExecutor 사용 (리소스 절약)
  executor: LocalExecutor

  waitForMigrations:
    enabled: true
    timeout: 600

  migrateDatabaseJob:
    enabled: true

  createUserJob:
    enabled: true

  serviceAccount:
    create: true
    name: ""

  postgresql:
    image:
      registry: docker.io
      repository: bitnami/postgresql
      tag: latest
    enabled: true
    auth:
      username: airflow
      password: "airflow"  # 로컬 개발용
      database: airflow
    persistence:
      enabled: true
      size: 10Gi
      storageClassName: "local-path"
    primary:
      resources:
        requests:
          memory: "256Mi"
          cpu: "250m"
        limits:
          memory: "512Mi"
          cpu: "500m"

  # LocalExecutor에서는 Redis 불필요
  redis:
    enabled: false

  dags:
    persistence:
      enabled: false
    gitSync:
      enabled: false

  logs:
    persistence:
      enabled: false

  webserver:
    replicas: 1
    service:
      type: NodePort
      ports:
        - name: airflow-ui
          port: 8080
          targetPort: 8080
          nodePort: 30808
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"
    startupProbe:
      initialDelaySeconds: 0
      timeoutSeconds: 20
      failureThreshold: 18
      periodSeconds: 10

  scheduler:
    replicas: 1
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
      limits:
        memory: "512Mi"
        cpu: "500m"

  # LocalExecutor에서는 Worker 불필요
  workers:
    replicas: 0

  flower:
    enabled: false

  triggerer:
    enabled: false

  env:
    - name: AIRFLOW__CORE__EXECUTOR
      value: "LocalExecutor"
    - name: AIRFLOW__CORE__LOAD_EXAMPLES
      value: "False"
    - name: AIRFLOW__WEBSERVER__EXPOSE_CONFIG
      value: "True"

  ingress:
    enabled: false
