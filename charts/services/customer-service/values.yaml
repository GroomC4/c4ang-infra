# Customer Service Helm Chart - 기본값
# 환경별 설정은 config/{env}/customer-service.yaml에서 관리
# 참고: docs/GITOPS-HELM-ARGOCD-GUIDE.md

fullnameOverride: customer-api

# 환경별로 오버라이드됨
replicaCount: 2

image:
  repository: ""  # config/{env}/customer-service.yaml에서 설정
  pullPolicy: IfNotPresent
  tag: ""         # config/{env}/customer-service.yaml에서 설정

imagePullSecrets: []

# 서비스 설정 (환경 무관)
service:
  type: ClusterIP
  port: 8081
  targetPort: 8081

# 기본 리소스 (환경별로 오버라이드 가능)
resources:
  requests:
    memory: 512Mi
    cpu: 250m
  limits:
    memory: 1Gi
    cpu: 500m

# 오토스케일링 (환경별로 오버라이드 가능)
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# 환경변수 - config/{env}/customer-service.yaml에서 정의
config:
  JWT_ACCESS_TOKEN_EXPIRATION_MINUTES: "4320"  # 3일 (테스트용)

# 시크릿 - config/{env}/customer-service.yaml에서 정의
secrets: {}

# 추가 환경변수
extraEnv: []

# Redis subchart (비활성화 - ExternalName 서비스 사용)
redis:
  enabled: false

# Istio 설정 (환경 무관한 공통 설정)
istio:
  enabled: true
  pathPrefix: /api/v1/customers
  timeout: 30s
  retries:
    attempts: 3
    perTryTimeout: 10s
    retryOn: "5xx,reset,connect-failure,refused-stream"
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 50
        http2MaxRequests: 100
        maxRequestsPerConnection: 2
    outlierDetection:
      consecutive5xxErrors: 5
      interval: 10s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
      minHealthPercent: 40
  gatewayAPI:
    enabled: true
    gatewayName: ecommerce-gateway
    gatewayNamespace: ecommerce
    hostnames:
      - api.c4ang.com

# Argo Rollouts 분석
analysis:
  prometheusUrl: "http://prometheus.monitoring.svc.cluster.local:9090"
