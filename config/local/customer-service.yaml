# customer-service 로컬 환경 설정
# docker-compose로 띄운 외부 서비스에 연결

replicaCount: 1

# 1. 이미지 교체 (데모용)
image:
  repository: argoproj/rollouts-demo
  pullPolicy: Always
  tag: "blue"   # 중요: v1.0.10 아님! blue로 해야 함

# 2. 시크릿 비우기 (공개 이미지라 필요 없음)
imagePullSecrets: []

# 3. 서비스 포트 맞추기 (데모앱은 8080 씀)
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080 # 중요: 8081 아님!

autoscaling:
  enabled: false

resources:
  requests:
    memory: 512Mi
    cpu: 100m
  limits:
    memory: 1Gi
    cpu: 250m

# Application configuration (injected via ConfigMap)
config:
  SERVER_PORT: "8081"
  SPRING_PROFILES_ACTIVE: "prod"
  # PostgreSQL (ExternalName 서비스 사용)
  SPRING_DATASOURCE_MASTER_URL: "jdbc:postgresql://customer-db:5432/customer_db"
  SPRING_DATASOURCE_REPLICA_URL: "jdbc:postgresql://customer-db:5432/customer_db"
  # Redis (ExternalName 서비스 사용)
  SPRING_DATA_REDIS_HOST: "cache-redis"
  SPRING_DATA_REDIS_PORT: "6379"
  SPRING_REDISSON_ADDRESS: "redis://cache-redis:6379"
  # Kafka (ExternalName 서비스 사용)
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "kafka:9092"
  SPRING_KAFKA_PRODUCER_BOOTSTRAP_SERVERS: "kafka:9092"
  SPRING_KAFKA_CONSUMER_BOOTSTRAP_SERVERS: "kafka:9092"

# Sensitive data (injected via Secret)
secrets:
  SPRING_DATASOURCE_MASTER_USERNAME: "postgres"
  SPRING_DATASOURCE_MASTER_PASSWORD: "postgres"
  SPRING_DATASOURCE_REPLICA_USERNAME: "postgres"
  SPRING_DATASOURCE_REPLICA_PASSWORD: "postgres"
  SPRING_REDIS_PASSWORD: ""
  SPRING_REDISSON_PASSWORD: ""

# Istio 설정 (기본값 사용)
