# Active Service: Points to the stable, production version.
# Argo Rollouts manages the endpoints of this service to point to the active (blue) pods.
# Best practice: Use base service name for active, add -preview suffix for preview.
apiVersion: v1
kind: Service
metadata:
  name: {{ include "customer-service.fullname" . }}
  labels:
    {{- include "customer-service.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  ports:
  - port: {{ .Values.service.port }}
    targetPort: {{ .Values.service.targetPort }}
    protocol: TCP
    name: http
  # No selector is needed. Argo Rollouts will manage the Endpoints.
---

# Preview Service: Points to the new version for testing.
# Argo Rollouts manages the endpoints of this service to point to the preview (green) pods.
apiVersion: v1
kind: Service
metadata:
  name: {{ include "customer-service.fullname" . }}-preview
  labels:
    {{- include "customer-service.labels" . | nindent 4 }}
spec:
  type: {{ .Values.service.type }}
  ports:
  - port: {{ .Values.service.port }}
    targetPort: {{ .Values.service.targetPort }}
    protocol: TCP
    name: http
  # No selector is needed. Argo Rollouts will manage the Endpoints.