# EKS 최소 리소스 설정
namespace: monitoring

# Grafana Alloy - CPU 요청 감소
alloy:
  enabled: true
  resources:
    limits:
      cpu: "300m"
      memory: "256Mi"
    requests:
      cpu: "100m"  # 기본 200m에서 감소
      memory: "128Mi"
  daemonset:
    tolerations:
      - key: "workload"
        operator: "Equal"
        value: "stateful"
        effect: "NoSchedule"

# Prometheus - 리소스 감소
prometheus:
  enabled: true
  storage:
    size: 20Gi  # 50Gi에서 감소
    storageClassName: "gp2"
  resources:
    limits:
      cpu: "500m"  # 1000m에서 감소
      memory: "1Gi"  # 2Gi에서 감소
    requests:
      cpu: "250m"  # 500m에서 감소
      memory: "512Mi"  # 1Gi에서 감소

# Loki - 리소스 감소
loki:
  enabled: true
  storage:
    size: 10Gi  # 20Gi에서 감소
    storageClassName: "gp2"
  resources:
    limits:
      cpu: "500m"  # 1000m에서 감소
      memory: "512Mi"  # 1Gi에서 감소
    requests:
      cpu: "250m"  # 500m에서 감소
      memory: "256Mi"  # 512Mi에서 감소

# Tempo - 리소스 감소
tempo:
  enabled: true
  storage:
    size: 10Gi  # 20Gi에서 감소
    storageClassName: "gp2"
  retention:
    period: 720h  # 30일 = 720시간
  resources:
    limits:
      cpu: "500m"  # 1000m에서 감소
      memory: "512Mi"  # 1Gi에서 감소
    requests:
      cpu: "250m"  # 500m에서 감소
      memory: "256Mi"  # 512Mi에서 감소

# Grafana - 리소스 유지
grafana:
  enabled: true
  admin:
    password: "admin"
  storage:
    size: 5Gi
    storageClassName: "gp2"
  resources:
    limits:
      cpu: "300m"  # 500m에서 감소
      memory: "256Mi"  # 512Mi에서 감소
    requests:
      cpu: "150m"  # 250m에서 감소
      memory: "128Mi"  # 256Mi에서 감소

# kube-state-metrics / node-exporter (필수 메트릭)
kubeStateMetrics:
  enabled: true
  resources:
    limits:
      cpu: "100m"
      memory: "128Mi"
    requests:
      cpu: "50m"
      memory: "64Mi"

nodeExporter:
  enabled: true
  resources:
    limits:
      cpu: "100m"
      memory: "64Mi"
    requests:
      cpu: "50m"
      memory: "32Mi"

# 알림 비활성화 (리소스 절약)
alerting:
  enabled: false

# Stateful 워크로드 노드 사용을 위한 Tolerations
tolerations:
  - key: "workload"
    operator: "Equal"
    value: "stateful"
    effect: "NoSchedule"

