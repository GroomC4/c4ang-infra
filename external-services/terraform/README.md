## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
Internet
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bastion Host   â”‚ â† ë³„ë„ êµ¬ì„± í•„ìš”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC-APP                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Public Subnet  â”‚  â”‚      Private Subnets        â”‚  â”‚
â”‚  â”‚   (Bastion)     â”‚  â”‚   (EKS Nodes + Apps)       â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                             â”‚  â”‚
â”‚  â”‚  Internet       â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  Gateway        â”‚  â”‚  â”‚   EKS Cluster       â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚                     â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”‚  Node Group   â”‚  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â”‚  (t3.medium)  â”‚  â”‚    â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPC-DB                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Private Subnets                        â”‚ â”‚
â”‚  â”‚              (Database Only)                        â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              RDS Subnet Group               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚              (AZ-a, AZ-b)                   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ ì£¼ìš” íŠ¹ì§•

### **ğŸ”’ ë³´ì•ˆ ì¤‘ì‹¬ ì„¤ê³„**
- **EKS ë…¸ë“œ**: Private Subnetì— ë°°ì¹˜
- **NAT Gateway**: ì™¸ë¶€ ì¸í„°ë„· ì ‘ê·¼ì„ ìœ„í•œ í†µë¡œ
- **VPC ê²©ë¦¬**: Appê³¼ DB VPC ì™„ì „ ë¶„ë¦¬
- **Bastion Host**: ë³„ë„ êµ¬ì„± í•„ìš” (ì´ ì½”ë“œì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ)

### **ğŸ’° ë¹„ìš© êµ¬ì¡°**
- **NAT Gateway**: í™œì„±í™” (ì‹œê°„ë‹¹ ë¹„ìš© ë°œìƒ)
- **EKS ë…¸ë“œ**: Private Subnet (ë³´ì•ˆì„± í–¥ìƒ)
- **VPC Endpoints**: ì„ íƒì  ì‚¬ìš©

### **ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**
- **VPC-APP**: Public + Private Subnet
- **VPC-DB**: Private Subnetë§Œ (ì™„ì „ ê²©ë¦¬)
- **VPC Peering**: App â†” DB ê°„ í†µì‹ 
- **Route Tables**: ìë™ êµ¬ì„±

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
terraform_private/
â”œâ”€â”€ main.tf                    # VPC, Security Groups, VPC Peering
â”œâ”€â”€ eks.tf                     # EKS Cluster ë° Node Groups
â”œâ”€â”€ variables.tf               # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf                 # ì¶œë ¥ê°’ ì •ì˜
â”œâ”€â”€ terraform.tfvars.example   # ë³€ìˆ˜ ì˜ˆì‹œ íŒŒì¼
â”œâ”€â”€ README.md                  # ì´ íŒŒì¼
â””â”€â”€ EKS_DEPLOYMENT_ANALYSIS.md # ë°°í¬ ë¶„ì„ ë³´ê³ ì„œ
```

## ğŸš€ ì‹œì‘í•˜ê¸°

### **1. ì‚¬ì „ ìš”êµ¬ì‚¬í•­**
```bash
# AWS CLI ì„¤ì •
aws configure

# Terraform ì„¤ì¹˜ (>= 1.0)
terraform version
```

### **2. ë³€ìˆ˜ ì„¤ì •**
```bash
# ì˜ˆì‹œ íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •
cp terraform.tfvars.example terraform.tfvars

# terraform.tfvars íŒŒì¼ í¸ì§‘
vim terraform.tfvars
```

### **3. ë°°í¬ ì‹¤í–‰**
```bash
# ì´ˆê¸°í™”
terraform init

# ê³„íš í™•ì¸
terraform plan

# ë°°í¬ ì‹¤í–‰
terraform apply

# eksë§Œ ë°°í¬ ì‹¤í–‰
# variables.tfì— create_eks = true/false í™•ì¸
terraform apply -target=module.eks


# eksë§Œ ë°°í¬ ì‚­ì œ
terraform destroy -target=module.eks

```

### **4. EKS ì ‘ê·¼**
```bash
# kubeconfig ì—…ë°ì´íŠ¸
aws eks update-kubeconfig --region ap-northeast-2 --name hihypipe-cluster

# í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
kubectl get nodes
kubectl get pods --all-namespaces
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

### **ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**
- **Bastion Host**: ë³„ë„ êµ¬ì„± í•„ìš” (ì´ ì½”ë“œì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ)
- **Private Subnet**: ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
- **NAT Gateway**: ë¹„ìš© ë°œìƒ (ì‹œê°„ë‹¹ ê³¼ê¸ˆ)

### **ğŸŒ ë„¤íŠ¸ì›Œí¬ ì œí•œì‚¬í•­**
- **ì™¸ë¶€ ì ‘ê·¼**: NAT Gatewayë¥¼ í†µí•´ì„œë§Œ ê°€ëŠ¥
- **EKS API**: Private Subnetì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
- **ì¸í„°ë„· ì—°ê²°**: NAT Gatewayë¥¼ í†µí•œ ìš°íšŒ í•„ìš”

### **ğŸ’° ë¹„ìš© ê³ ë ¤ì‚¬í•­**
- **NAT Gateway**: ì‹œê°„ë‹¹ ë¹„ìš© ë°œìƒ
- **ë°ì´í„° ì „ì†¡**: NAT Gatewayë¥¼ í†µí•œ íŠ¸ë˜í”½ ë¹„ìš©
- **EKS ë…¸ë“œ**: Private Subnet ë°°ì¹˜ë¡œ ë³´ì•ˆì„± í–¥ìƒ

## ğŸ”§ êµ¬ì„± ì˜µì…˜

### **VPC ì„¤ì •**
```hcl
# VPC-APP
enable_nat_gateway = true      # NAT Gateway í™œì„±í™”
single_nat_gateway = true      # ë‹¨ì¼ NAT Gateway (ë¹„ìš© ì ˆì•½)

# VPC-DB
create_igw = false             # Internet Gateway ë¹„í™œì„±í™”
enable_nat_gateway = false     # NAT Gateway ë¹„í™œì„±í™”
```

### **EKS ì„¤ì •**
```hcl
# Private Subnet ì‚¬ìš©
subnet_ids = module.vpc_app.private_subnets

# Public Endpoint ë¹„í™œì„±í™” (ê¸°ë³¸ê°’)
# endpoint_public_access = false
```

