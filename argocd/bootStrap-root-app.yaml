apiVersion: apps/v1
kind: Application
metadata:
  # 이것이 'App of Apps'의 최상위 부모 앱입니다.
  name: argocd-root
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: https://github.com/GroomC4/c4ang-infra.git
    targetRevision: main

    # 'root'는 c4ang-infra 레포지토리의 argocd-manifests 디렉토리를 바라봅니다.
    path: argocd/manifest

  destination:
    # 'root' 앱 자체는 argocd 네임스페이스에 정의됩니다.
    server: https://kubernetes.default.svc
    namespace: argocd

  # 'root' 앱이 'root-apps.yaml'의 변경 사항을 자동으로 감지하고 적용하게 합니다.
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true