.PHONY: help start stop restart logs status setup clean upsert-perfume upsert-keyword

SCRIPTS_DIR := scripts

.PHONY: help start stop restart logs status setup clean embed upsert-local upsert-cloud

help: ## ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ í‘œì‹œ
	@echo "Pinecone Local ê°œë°œ í™˜ê²½"
	@echo ""
	@echo "ì‚¬ìš©ë²•: make [command]"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

start: ## Pinecone Local ì»¨í…Œì´ë„ˆ ì‹œì‘
	@echo "ğŸš€ Pinecone Local ì‹œì‘ ì¤‘..."
	docker-compose up -d
	@echo "âœ… ì»¨í…Œì´ë„ˆ ì‹œì‘ ì™„ë£Œ"
	@make status

stop: ## Pinecone Local ì»¨í…Œì´ë„ˆ ì¤‘ì§€
	@echo "ğŸ›‘ Pinecone Local ì¤‘ì§€ ì¤‘..."
	docker-compose down
	@echo "âœ… ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì™„ë£Œ"

restart: ## Pinecone Local ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
	@echo "ğŸ”„ Pinecone Local ì¬ì‹œì‘ ì¤‘..."
	docker-compose restart
	@echo "âœ… ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì™„ë£Œ"

logs: ## ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
	docker logs -f pinecone-local

status: ## ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
	@echo "ğŸ“Š ì»¨í…Œì´ë„ˆ ìƒíƒœ:"
	@docker ps | grep pinecone-local || echo "âŒ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘ì´ì§€ ì•ŠìŠµë‹ˆë‹¤"
	@echo ""
	@echo "ğŸ” í—¬ìŠ¤ì²´í¬:"
	@curl -s http://localhost:5081/ > /dev/null && echo "âœ… Pinecone Local ì •ìƒ ì‘ë™ ì¤‘" || echo "âŒ Pinecone Local ì‘ë‹µ ì—†ìŒ"

setup: ## Python í™˜ê²½ ì„¤ì • (ê°€ìƒí™˜ê²½ + ì˜ì¡´ì„±)
	@echo "ğŸ”§ Python í™˜ê²½ ì„¤ì • ì¤‘..."
	cd $(SCRIPTS_DIR) && python3 -m venv venv
	cd $(SCRIPTS_DIR) && . venv/bin/activate && pip install --upgrade pip
	cd $(SCRIPTS_DIR) && . venv/bin/activate && pip install -r requirements.txt
	@echo "âœ… Python í™˜ê²½ ì„¤ì • ì™„ë£Œ"
	@echo ""
	@echo "ğŸ“ ë‹¤ìŒ ë‹¨ê³„:"
	@echo "  1. cp .env.example .env"
	@echo "  2. .env íŒŒì¼ì—ì„œ OPENAI_API_KEY ì„¤ì •"
	@echo "  3. cd $(SCRIPTS_DIR)"
	@echo "  4. source venv/bin/activate"
	@echo "  5. python generate_embeddings.py"

clean: ## ê°€ìƒí™˜ê²½ ë° ìºì‹œ ì‚­ì œ
	@echo "ğŸ§¹ ì •ë¦¬ ì¤‘..."
	rm -rf $(SCRIPTS_DIR)/venv
	rm -rf $(SCRIPTS_DIR)/__pycache__
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ"

embed: ## ì„ë² ë”© ìƒì„± (íŒŒì¼ë¡œ ì €ì¥)
	@echo "ğŸ§® ì„ë² ë”© ìƒì„± ì¤‘..."
	cd $(SCRIPTS_DIR) && . venv/bin/activate && python generate_embeddings.py

upsert-local: ## ë¡œì»¬ Pineconeì— ì—…ì„œíŠ¸ (ì„ë² ë”© íŒŒì¼ í•„ìš”)
	@echo "ğŸ“¤ ë¡œì»¬ Pineconeì— ì—…ì„œíŠ¸ ì¤‘..."
	cd $(SCRIPTS_DIR) && . venv/bin/activate && python upsert_from_file.py

upsert-cloud: ## í´ë¼ìš°ë“œ Pineconeì— ì—…ì„œíŠ¸ (ì„ë² ë”© íŒŒì¼ í•„ìš”)
	@echo "ğŸ“¤ í´ë¼ìš°ë“œ Pineconeì— ì—…ì„œíŠ¸ ì¤‘..."
	cd $(SCRIPTS_DIR) && . venv/bin/activate && python upsert_from_file.py --cloud

init: start setup ## ì „ì²´ ì´ˆê¸° ì„¤ì • (ì»¨í…Œì´ë„ˆ ì‹œì‘ + Python í™˜ê²½)
	@echo ""
	@echo "ğŸ‰ ì´ˆê¸° ì„¤ì • ì™„ë£Œ!"
	@echo ""
	@echo "ğŸ“ ë‹¤ìŒ ë‹¨ê³„:"
	@echo "  1. cp .env.example .env"
	@echo "  2. .env íŒŒì¼ì—ì„œ OPENAI_API_KEY ì„¤ì •"
	@echo "  3. make embed          # ì„ë² ë”© ìƒì„±"
	@echo "  4. make upsert-local   # ë¡œì»¬ì— ì—…ë¡œë“œ"
