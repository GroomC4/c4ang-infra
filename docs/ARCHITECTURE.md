# C4ang E-commerce í”Œë«í¼ ì•„í‚¤í…ì²˜

> **í”„ë¡œì íŠ¸**: C4ang E-commerce ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í”Œë«í¼  
> **ì¸í”„ë¼**: AWS EKS + Istio Service Mesh  
> **ë²„ì „**: 1.0  
> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-17

---

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì „ì²´-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
2. [Kubernetes ì•„í‚¤í…ì²˜](#kubernetes-ì•„í‚¤í…ì²˜)
3. [ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜ (Istio)](#ë„¤íŠ¸ì›Œí¬-ì•„í‚¤í…ì²˜-istio)
   - [Blue/Green ë°°í¬ ìƒì„¸](#bluegreen-ë°°í¬-ìƒì„¸)
4. [ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜](#ë°ì´í„°-íŒŒì´í”„ë¼ì¸-ì•„í‚¤í…ì²˜)
5. [ë³´ì•ˆ ì•„í‚¤í…ì²˜](#ë³´ì•ˆ-ì•„í‚¤í…ì²˜)
6. [í™˜ê²½ë³„ êµ¬ì„±](#í™˜ê²½ë³„-êµ¬ì„±)
7. [ì»´í¬ë„ŒíŠ¸ ìƒì„¸](#ì»´í¬ë„ŒíŠ¸-ìƒì„¸)
8. [íŠ¸ë˜í”½ ë° ìš©ëŸ‰ ê³„íš](#íŠ¸ë˜í”½-ë°-ìš©ëŸ‰-ê³„íš)
9. [CI/CD íŒŒì´í”„ë¼ì¸ (Blue/Green ë°°í¬)](#cicd-íŒŒì´í”„ë¼ì¸-bluegreen-ë°°í¬)

---

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### High-Level Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Internet Users                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Route53 (DNS)         â”‚
                    â”‚   api.c4ang.com         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AWS Network           â”‚
                    â”‚   Load Balancer (NLB)   â”‚
                    â”‚   Multi-AZ              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS EKS Cluster                                      â”‚
â”‚                                â”‚                                             â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                   â”‚   Istio Ingress         â”‚                               â”‚
â”‚                   â”‚   Gateway               â”‚                               â”‚
â”‚                   â”‚   (istio-system)        â”‚                               â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚          Istio Service Mesh (ecommerce namespace)      â”‚                â”‚
â”‚   â”‚                            â”‚                            â”‚                â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚
â”‚   â”‚   â”‚     VirtualServices (ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…)        â”‚   â”‚                â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚
â”‚   â”‚                            â”‚                            â”‚                â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚
â”‚   â”‚   â”‚          Microservices Layer                   â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”‚Customer  â”‚  â”‚  Order   â”‚  â”‚ Product  â”‚    â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚    â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”‚  (2 pod) â”‚  â”‚  (2 pod) â”‚  â”‚  (2 pod) â”‚    â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚   â”‚                â”‚
â”‚   â”‚   â”‚       â”‚             â”‚             â”‚           â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”‚ Payment  â”‚  â”‚  Recom   â”‚  â”‚   Saga   â”‚   â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”‚ Service  â”‚  â”‚ -mend    â”‚  â”‚  Tracker â”‚   â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â”‚  (2 pod) â”‚  â”‚ Service  â”‚  â”‚  (2 pod) â”‚   â”‚   â”‚                â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  (2 pod) â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚   â”‚                â”‚
â”‚   â”‚   â”‚       â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚          â”‚   â”‚                â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚               â”‚             â”‚             â”‚                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚                Data Layer                              â”‚                â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                â”‚
â”‚   â”‚   â”‚  Redis          â”‚        â”‚  External RDS   â”‚     â”‚                â”‚
â”‚   â”‚   â”‚  (StatefulSet)  â”‚        â”‚  (PostgreSQL)   â”‚     â”‚                â”‚
â”‚   â”‚   â”‚  - Cache        â”‚        â”‚  - Orders       â”‚     â”‚                â”‚
â”‚   â”‚   â”‚  - Session      â”‚        â”‚  - Products     â”‚     â”‚                â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  - Customers    â”‚     â”‚                â”‚
â”‚   â”‚                               â”‚  - Payments     â”‚     â”‚                â”‚
â”‚   â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚          Management Layer (airflow namespace)          â”‚               â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚               â”‚
â”‚   â”‚   â”‚  Apache Airflow (CeleryExecutor)            â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â”‚Webserver â”‚  â”‚Scheduler â”‚  â”‚ WorkerÃ—2 â”‚  â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚     â”‚               â”‚
â”‚   â”‚   â”‚       â”‚             â”‚             â”‚         â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â”‚    PostgreSQL (Metadata DB)           â”‚ â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â”‚    Redis (Celery Broker)              â”‚ â”‚     â”‚               â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚               â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚               â”‚
â”‚   â”‚                       â”‚                                â”‚               â”‚
â”‚   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚               â”‚
â”‚   â”‚              â”‚  DAGs (PVC)     â”‚                       â”‚               â”‚
â”‚   â”‚              â”‚  - daily_rec    â”‚                       â”‚               â”‚
â”‚   â”‚              â”‚  - weekly_sent  â”‚                       â”‚               â”‚
â”‚   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AWS Lambda             â”‚
                    â”‚  (Sentiment Analysis)   â”‚
                    â”‚  - HuggingFace Model    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” ê³„ì¸µ

| ê³„ì¸µ | ì»´í¬ë„ŒíŠ¸ | ì—­í•  | ê¸°ìˆ  ìŠ¤íƒ |
|------|----------|------|-----------|
| **External** | Route53, NLB | DNS, ë¡œë“œë°¸ëŸ°ì‹± | AWS Route53, NLB |
| **Gateway** | Istio Ingress Gateway | ì™¸ë¶€ íŠ¸ë˜í”½ ì§„ì…ì  | Istio 1.28.0 |
| **Service Mesh** | VirtualService, DestinationRule | ë¼ìš°íŒ…, íŠ¸ë˜í”½ ê´€ë¦¬ | Istio |
| **Application** | 6ê°œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | Spring Boot (ì˜ˆì •) |
| **Data** | PostgreSQL, Redis | ì˜êµ¬ ì €ì¥, ìºì‹± | AWS RDS, Redis StatefulSet |
| **Pipeline** | Airflow | ë°ì´í„° ì²˜ë¦¬, ì¶”ì²œ | Apache Airflow 2.x |
| **Serverless** | Lambda | ML ì¶”ë¡  | AWS Lambda + HuggingFace |

---

## â˜¸ï¸ Kubernetes ì•„í‚¤í…ì²˜

### EKS Cluster êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EKS Cluster (c4ang-cluster)                        â”‚
â”‚                        Region: ap-northeast-2 (Seoul)                        â”‚
â”‚                           K8s Version: 1.28+                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       Control Plane (Managed by AWS)                    â”‚ â”‚
â”‚  â”‚  - API Server                                                           â”‚ â”‚
â”‚  â”‚  - Controller Manager                                                   â”‚ â”‚
â”‚  â”‚  - Scheduler                                                            â”‚ â”‚
â”‚  â”‚  - etcd                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          Worker Nodes (Multi-AZ)                        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚  AZ-2a Node     â”‚   â”‚  AZ-2b Node     â”‚   â”‚  AZ-2c Node     â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  Instance Type: â”‚   â”‚  Instance Type: â”‚   â”‚  Instance Type: â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  t3.medium      â”‚   â”‚  t3.medium      â”‚   â”‚  t3.medium      â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  Pods:          â”‚   â”‚  Pods:          â”‚   â”‚  Pods:          â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  - customer-api â”‚   â”‚  - order-api    â”‚   â”‚  - product-api  â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  - payment-api  â”‚   â”‚  - recom-api    â”‚   â”‚  - saga-tracker â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  - istio-proxy  â”‚   â”‚  - istio-proxy  â”‚   â”‚  - istio-proxy  â”‚     â”‚ â”‚
â”‚  â”‚  â”‚  - airflow-*    â”‚   â”‚  - airflow-*    â”‚   â”‚  - redis        â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                            Namespaces                                   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚  istio-system   â”‚   â”‚  ecommerce      â”‚   â”‚  airflow        â”‚     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ istiod        â”‚   â”‚ â€¢ customer-api  â”‚   â”‚ â€¢ webserver     â”‚     â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ ingress-gw    â”‚   â”‚ â€¢ order-api     â”‚   â”‚ â€¢ scheduler     â”‚     â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ egress-gw     â”‚   â”‚ â€¢ product-api   â”‚   â”‚ â€¢ workerÃ—2      â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚   â”‚ â€¢ payment-api   â”‚   â”‚ â€¢ postgresql    â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚   â”‚ â€¢ recom-api     â”‚   â”‚ â€¢ redis         â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚   â”‚ â€¢ saga-tracker  â”‚   â”‚ â€¢ flower        â”‚     â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚   â”‚ â€¢ redis         â”‚   â”‚                 â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚ â”‚
â”‚  â”‚  â”‚  kube-system    â”‚   â”‚  default        â”‚                            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ coredns       â”‚   â”‚ (empty)         â”‚                            â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ aws-node      â”‚   â”‚                 â”‚                            â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ kube-proxy    â”‚   â”‚                 â”‚                            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        Persistent Storage                               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  EBS Volumes (AWS gp3)                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ airflow-logs-pvc        (10Gi)                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ airflow-dags-pvc        (5Gi)                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ airflow-postgresql-pvc  (8Gi)                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ redis-master-pvc        (8Gi)                                â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Helm Charts êµ¬ì¡°

```
helm/
â”œâ”€â”€ services/                           # ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ Helm Charts
â”‚   â”œâ”€â”€ customer-service/
â”‚   â”‚   â”œâ”€â”€ Chart.yaml                  # Chart ë©”íƒ€ë°ì´í„°
â”‚   â”‚   â”œâ”€â”€ values.yaml                 # ê¸°ë³¸ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ values-eks-test.yaml        # EKS í…ŒìŠ¤íŠ¸ ì„¤ì •
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â”œâ”€â”€ deployment.yaml         # Deployment + Istio Sidecar
â”‚   â”‚       â”œâ”€â”€ service.yaml            # ClusterIP Service
â”‚   â”‚       â”œâ”€â”€ configmap.yaml          # í™˜ê²½ ì„¤ì •
â”‚   â”‚       â”œâ”€â”€ virtualservice.yaml     # Istio ë¼ìš°íŒ…
â”‚   â”‚       â”œâ”€â”€ destinationrule.yaml    # Istio íŠ¸ë˜í”½ ì •ì±…
â”‚   â”‚       â”œâ”€â”€ httproute.yaml          # Gateway API (ì„ íƒ)
â”‚   â”‚       â””â”€â”€ hpa.yaml                # Horizontal Pod Autoscaler
â”‚   â”œâ”€â”€ order-service/                  # ë™ì¼ êµ¬ì¡°
â”‚   â”œâ”€â”€ product-service/
â”‚   â”œâ”€â”€ payment-service/
â”‚   â”œâ”€â”€ recommendation-service/
â”‚   â””â”€â”€ saga-tracker/
â”‚
â”œâ”€â”€ management-base/                    # ê´€ë¦¬ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ airflow/
â”‚   â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”‚   â”œâ”€â”€ values.yaml
â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚       â””â”€â”€ (Apache Airflow Helm Chart Wrapper)
â”‚   â””â”€â”€ istio/
â”‚       â”œâ”€â”€ Chart.yaml
â”‚       â””â”€â”€ templates/
â”‚           â””â”€â”€ (Istio Base ì„¤ì¹˜)
â”‚
â””â”€â”€ statefulset-base/                   # StatefulSet ê¸°ë°˜ ì„œë¹„ìŠ¤
    â”œâ”€â”€ postgresql/                     # PostgreSQL Chart
    â”‚   â””â”€â”€ (Bitnami PostgreSQL Wrapper)
    â””â”€â”€ redis/                          # Redis Chart
        â”œâ”€â”€ Chart.yaml
        â”œâ”€â”€ values.yaml
        â””â”€â”€ templates/
            â”œâ”€â”€ statefulset.yaml
            â”œâ”€â”€ service.yaml
            â””â”€â”€ configmap.yaml
```

### ë¦¬ì†ŒìŠ¤ í• ë‹¹

#### Microservices

| Service | Replicas | CPU Request | CPU Limit | Memory Request | Memory Limit | HPA |
|---------|----------|-------------|-----------|----------------|--------------|-----|
| customer-service | 2 | 50m | 100m | 64Mi | 128Mi | âŒ |
| order-service | 2 | 50m | 100m | 64Mi | 128Mi | âŒ |
| product-service | 2 | 50m | 100m | 64Mi | 128Mi | âŒ |
| payment-service | 2 | 50m | 100m | 64Mi | 128Mi | âŒ |
| recommendation-service | 2 | 50m | 100m | 64Mi | 128Mi | âŒ |
| saga-tracker | 2 | 50m | 100m | 64Mi | 128Mi | âŒ |

**ì´ ë¦¬ì†ŒìŠ¤**: 12 Pods, 600m CPU, 768Mi Memory (+ Istio Sidecars)

#### Airflow

| Component | Replicas | CPU Request | CPU Limit | Memory Request | Memory Limit |
|-----------|----------|-------------|-----------|----------------|--------------|
| Webserver | 1 | 500m | 1000m | 512Mi | 1Gi |
| Scheduler | 1 | 500m | 1000m | 512Mi | 1Gi |
| Worker | 2 | 500m | 1000m | 1Gi | 2Gi |
| PostgreSQL | 1 | 500m | 1000m | 512Mi | 1Gi |
| Redis | 1 | 250m | 500m | 256Mi | 512Mi |
| Flower | 1 | 250m | 500m | 256Mi | 512Mi |

**ì´ ë¦¬ì†ŒìŠ¤**: 7 Pods, 3000m CPU, 3.5Gi Memory

#### StatefulSets

| Service | Replicas | CPU Request | Memory Request | Storage |
|---------|----------|-------------|----------------|---------|
| Redis (ecommerce) | 1 | 250m | 512Mi | 8Gi |

---

## ğŸŒ ë„¤íŠ¸ì›Œí¬ ì•„í‚¤í…ì²˜

### Istio Service Mesh êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Internet (Port 80/443)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AWS NLB               â”‚
                    â”‚   Type: network         â”‚
                    â”‚   Scheme: internet-     â”‚
                    â”‚           facing        â”‚
                    â”‚   Target: IP            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Port 80, 443
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Namespace: istio-system       â”‚                                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚ Istio Ingress Gateway  â”‚                               â”‚
â”‚                    â”‚ Service: LoadBalancer  â”‚                               â”‚
â”‚                    â”‚ Selector:              â”‚                               â”‚
â”‚                    â”‚   istio=ingressgateway â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                â”‚                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚  Gateway Resource      â”‚                               â”‚
â”‚                    â”‚  Name: ecommerce-gw    â”‚                               â”‚
â”‚                    â”‚  Hosts:                â”‚                               â”‚
â”‚                    â”‚    - api.c4ang.com     â”‚                               â”‚
â”‚                    â”‚    - *                 â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Namespace: ecommerce          â”‚                                            â”‚
â”‚                                â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚    VirtualServices (ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ… + Blue/Green)     â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚   â”‚                            â”‚                           â”‚                â”‚
â”‚   â”‚  /api/v1/customers â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ customer-api          â”‚                â”‚
â”‚   â”‚  /api/v1/orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ order-api             â”‚                â”‚
â”‚   â”‚  /api/v1/products â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ product-api           â”‚                â”‚
â”‚   â”‚  /api/v1/payments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ payment-api           â”‚                â”‚
â”‚   â”‚  /api/v1/recommendations â”€â”€â”¼â”€â”€â†’ recommendation-api    â”‚                â”‚
â”‚   â”‚  /api/v1/saga â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ saga-tracker          â”‚                â”‚
â”‚   â”‚                            â”‚                           â”‚                â”‚
â”‚   â”‚  Blue/Green íŠ¸ë˜í”½ ë¶„ë°°:   â”‚                           â”‚                â”‚
â”‚   â”‚    Blue (í˜„ì¬):   100%     â”‚ (ë˜ëŠ” Green: 100%)       â”‚                â”‚
â”‚   â”‚    Green (ì‹ ê·œ):  0%       â”‚                           â”‚                â”‚
â”‚   â”‚                            â”‚                           â”‚                â”‚
â”‚   â”‚  Timeout: 30s              â”‚                           â”‚                â”‚
â”‚   â”‚  Retries: 3 attempts       â”‚                           â”‚                â”‚
â”‚   â”‚  Retry On: 5xx, reset,     â”‚                           â”‚                â”‚
â”‚   â”‚            connect-failure  â”‚                           â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚   DestinationRules (íŠ¸ë˜í”½ ì •ì±… + Blue/Green Subsets) â”‚                â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚   â”‚                                                        â”‚                â”‚
â”‚   â”‚  Subsets (ë²„ì „ ê¸°ë°˜):                                  â”‚                â”‚
â”‚   â”‚    - blue  (version: v1.0.0)                          â”‚                â”‚
â”‚   â”‚    - green (version: v1.1.0)                          â”‚                â”‚
â”‚   â”‚                                                        â”‚                â”‚
â”‚   â”‚  Connection Pool:                                     â”‚                â”‚
â”‚   â”‚    TCP Max Connections: 100                           â”‚                â”‚
â”‚   â”‚    HTTP1 Max Pending Requests: 50                     â”‚                â”‚
â”‚   â”‚    HTTP2 Max Requests: 100                            â”‚                â”‚
â”‚   â”‚                                                        â”‚                â”‚
â”‚   â”‚  Circuit Breaker (Outlier Detection):                 â”‚                â”‚
â”‚   â”‚    Consecutive 5xx Errors: 5                          â”‚                â”‚
â”‚   â”‚    Interval: 10s                                      â”‚                â”‚
â”‚   â”‚    Base Ejection Time: 30s                            â”‚                â”‚
â”‚   â”‚    Max Ejection Percent: 50%                          â”‚                â”‚
â”‚   â”‚                                                        â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ customer-api     â”‚   â”‚ order-api        â”‚   â”‚ product-api      â”‚      â”‚
â”‚   â”‚ Service          â”‚   â”‚ Service          â”‚   â”‚ Service          â”‚      â”‚
â”‚   â”‚ (ClusterIP)      â”‚   â”‚ (ClusterIP)      â”‚   â”‚ (ClusterIP)      â”‚      â”‚
â”‚   â”‚ Port: 8080       â”‚   â”‚ Port: 8080       â”‚   â”‚ Port: 8080       â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚            â”‚                      â”‚                       â”‚                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ customer-api-pod â”‚   â”‚ order-api-pod    â”‚   â”‚ product-api-pod  â”‚     â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚   â”‚ â”‚ Application  â”‚ â”‚   â”‚ â”‚ Application  â”‚ â”‚   â”‚ â”‚ Application  â”‚ â”‚     â”‚
â”‚   â”‚ â”‚ Container    â”‚ â”‚   â”‚ â”‚ Container    â”‚ â”‚   â”‚ â”‚ Container    â”‚ â”‚     â”‚
â”‚   â”‚ â”‚ Port: 5678   â”‚ â”‚   â”‚ â”‚ Port: 5678   â”‚ â”‚   â”‚ â”‚ Port: 5678   â”‚ â”‚     â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚   â”‚        â”‚         â”‚   â”‚        â”‚         â”‚   â”‚        â”‚         â”‚     â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚   â”‚ â”‚ Istio Proxy  â”‚ â”‚   â”‚ â”‚ Istio Proxy  â”‚ â”‚   â”‚ â”‚ Istio Proxy  â”‚ â”‚     â”‚
â”‚   â”‚ â”‚ (Envoy)      â”‚ â”‚   â”‚ â”‚ (Envoy)      â”‚ â”‚   â”‚ â”‚ (Envoy)      â”‚ â”‚     â”‚
â”‚   â”‚ â”‚ Port: 15001  â”‚ â”‚   â”‚ â”‚ Port: 15001  â”‚ â”‚   â”‚ â”‚ Port: 15001  â”‚ â”‚     â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚            â”‚                      â”‚                       â”‚                 â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                   â”‚                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚   istiod (Control Plane)    â”‚                         â”‚
â”‚                    â”‚   - Pilot (Service Discovery)â”‚                        â”‚
â”‚                    â”‚   - Citadel (mTLS)          â”‚                         â”‚
â”‚                    â”‚   - Galley (Configuration)   â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íŠ¸ë˜í”½ íë¦„

#### ì™¸ë¶€ â†’ ì„œë¹„ìŠ¤

```
1. ì‚¬ìš©ì â†’ api.c4ang.com/api/v1/orders
   â†“
2. Route53 DNS í•´ì„ â†’ NLB IP
   â†“
3. NLB (Port 80) â†’ Istio Ingress Gateway (Port 80)
   â†“
4. Istio Gateway Resource ë§¤ì¹­ (Host: api.c4ang.com)
   â†“
5. VirtualService ê²½ë¡œ ë§¤ì¹­ (/api/v1/orders â†’ order-api)
   â†“
6. DestinationRule íŠ¸ë˜í”½ ì •ì±… ì ìš© (Connection Pool, Circuit Breaker)
   â†“
7. Kubernetes Service (order-api:8080) â†’ Endpoints ì„ íƒ
   â†“
8. Podì˜ Istio Proxy (Envoy) â†’ Application Container (Port 5678)
   â†“
9. Application ì²˜ë¦¬ â†’ ì‘ë‹µ
   â†“
10. ì—­ìˆœìœ¼ë¡œ ì‘ë‹µ ë°˜í™˜ â†’ ì‚¬ìš©ì
```

#### ì„œë¹„ìŠ¤ ê°„ í†µì‹ 

```
1. Order Service â†’ Product Service í˜¸ì¶œ
   order-api-podì˜ Application Container
   â†“
2. Localhost:15001 â†’ Istio Proxy (Envoy)
   â†“
3. Istio Proxyê°€ Service Discovery (istiod)
   â†“
4. product-api Serviceë¡œ ë¼ìš°íŒ…
   â†“
5. product-api-podì˜ Istio Proxy â†’ Application Container
   â†“
6. ì‘ë‹µ ë°˜í™˜

(mTLS í™œì„±í™” ì‹œ ëª¨ë“  í†µì‹  ì•”í˜¸í™”)
```

### Service Mesh ê¸°ëŠ¥

| ê¸°ëŠ¥ | êµ¬í˜„ ë°©ë²• | ì„¤ì • ìœ„ì¹˜ |
|------|-----------|----------|
| **ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…** | VirtualService | `templates/virtualservice.yaml` |
| **Blue/Green ë°°í¬** | VirtualService (weight) + DestinationRule (subset) | `templates/virtualservice.yaml`, `templates/destinationrule.yaml` |
| **Timeout** | 30s | VirtualService spec |
| **Retry** | 3íšŒ, 10s per try | VirtualService spec |
| **Connection Pool** | TCP 100, HTTP 50/100 | DestinationRule trafficPolicy |
| **Circuit Breaker** | 5íšŒ 5xx â†’ 30s ê²©ë¦¬ | DestinationRule outlierDetection |
| **Load Balancing** | Round Robin (ê¸°ë³¸) | DestinationRule trafficPolicy |
| **mTLS** | STRICT mode (ì˜ˆì •) | PeerAuthentication |
| **Rate Limiting** | ì˜ˆì • | EnvoyFilter |
| **Observability** | Kiali, Grafana, Jaeger | Istio Addons |

### Blue/Green ë°°í¬ ìƒì„¸

#### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       NLB (ê³ ì • ì—”ë“œí¬ì¸íŠ¸)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Istio Ingress Gateway  â”‚
                â”‚  (ë³€ê²½ ì—†ìŒ)             â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        VirtualService                 â”‚
         â”‚  (íŠ¸ë˜í”½ ë¶„ë°° ë¹„ìœ¨ ì¡°ì •)               â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚  http:                                â”‚
         â”‚    - route:                           â”‚
         â”‚        - destination:                 â”‚
         â”‚            host: customer-api         â”‚
         â”‚            subset: blue      â—„â”€â”€â”€â”€â”€â”  â”‚
         â”‚          weight: 100         â”‚ ë‹¨ê³„ 1â”‚ â”‚
         â”‚        - destination:        â”‚      â”‚  â”‚
         â”‚            host: customer-apiâ”‚      â”‚  â”‚
         â”‚            subset: green     â”‚      â”‚  â”‚
         â”‚          weight: 0           â”‚      â”‚  â”‚
         â”‚                              â”‚      â”‚  â”‚
         â”‚  ë°°í¬ ì¤‘ weight ì¡°ì •:         â”‚      â”‚  â”‚
         â”‚    Blue: 100 â†’ 0             â”‚ ë‹¨ê³„ 2â”‚ â”‚
         â”‚    Green: 0 â†’ 100            â”‚      â”‚  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
    â”‚                                â”‚             â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ DestinationRule  â”‚    â”‚  DestinationRule    â”‚   â”‚
â”‚ customer-api     â”‚    â”‚  (Subsets ì •ì˜)     â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ subsets:         â”‚    â”‚ - name: blue        â”‚â—„â”€â”€â”˜
â”‚   - name: blue   â”‚    â”‚   labels:           â”‚
â”‚     labels:      â”‚    â”‚     version: v1.0.0 â”‚
â”‚       version:   â”‚    â”‚                     â”‚
â”‚         v1.0.0   â”‚    â”‚ - name: green       â”‚
â”‚                  â”‚    â”‚   labels:           â”‚
â”‚   - name: green  â”‚    â”‚     version: v1.1.0 â”‚
â”‚     labels:      â”‚    â”‚                     â”‚
â”‚       version:   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚         v1.1.0   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Deployment        â”‚  â”‚  Deployment         â”‚
    â”‚  customer-api-blue â”‚  â”‚  customer-api-green â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  replicas: 2       â”‚  â”‚  replicas: 2        â”‚
    â”‚  labels:           â”‚  â”‚  labels:            â”‚
    â”‚    app: customer   â”‚  â”‚    app: customer    â”‚
    â”‚    version: v1.0.0 â”‚  â”‚    version: v1.1.0  â”‚
    â”‚                    â”‚  â”‚                      â”‚
    â”‚  image:            â”‚  â”‚  image:              â”‚
    â”‚    customer:1.0.0  â”‚  â”‚    customer:1.1.0   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë°°í¬ í”„ë¡œì„¸ìŠ¤

**Phase 1: Blue í™˜ê²½ (ìš´ì˜ ì¤‘)**
```yaml
# VirtualService ì„¤ì •
spec:
  http:
    - route:
        - destination:
            host: customer-api
            subset: blue
          weight: 100  # â† ëª¨ë“  íŠ¸ë˜í”½
        - destination:
            host: customer-api
            subset: green
          weight: 0    # â† íŠ¸ë˜í”½ ì—†ìŒ
```

**Phase 2: Green ë°°í¬ ë° ê²€ì¦**
```bash
# 1. Green í™˜ê²½ ë°°í¬
kubectl apply -f deployment-green.yaml

# 2. Green Pod í—¬ìŠ¤ ì²´í¬
kubectl wait --for=condition=ready pod -l version=v1.1.0

# 3. ë‚´ë¶€ í…ŒìŠ¤íŠ¸ (Green ì§ì ‘ í˜¸ì¶œ)
kubectl exec -it test-pod -- curl http://customer-api:8080/health
  -H "version: v1.1.0"  # Istio Headerë¡œ ë¼ìš°íŒ…

# 4. Smoke Test ì„±ê³µ í™•ì¸
```

**Phase 3: Traffic Switching (ì¦‰ì‹œ ì „í™˜)**
```bash
# VirtualService ì—…ë°ì´íŠ¸ (Blue 0% â†’ Green 100%)
kubectl patch virtualservice customer-api-vs -n ecommerce --type merge -p '
{
  "spec": {
    "http": [{
      "route": [
        {"destination": {"host": "customer-api", "subset": "blue"}, "weight": 0},
        {"destination": {"host": "customer-api", "subset": "green"}, "weight": 100}
      ]
    }]
  }
}'

# ì¦‰ì‹œ ì „í™˜ (Istioê°€ 1-2ì´ˆ ë‚´ ë°˜ì˜)
```

**Phase 4: ë¡¤ë°± ê°€ëŠ¥ ìƒíƒœ ìœ ì§€**
```bash
# Green í™˜ê²½ ëª¨ë‹ˆí„°ë§ (5-10ë¶„)
- ì—ëŸ¬ìœ¨ ì²´í¬
- ë ˆì´í„´ì‹œ ì²´í¬
- ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ í™•ì¸

# ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ë¡¤ë°±
kubectl patch virtualservice customer-api-vs -n ecommerce --type merge -p '
{
  "spec": {
    "http": [{
      "route": [
        {"destination": {"host": "customer-api", "subset": "blue"}, "weight": 100},
        {"destination": {"host": "customer-api", "subset": "green"}, "weight": 0}
      ]
    }]
  }
}'
# â†’ 1-2ì´ˆ ë‚´ Blueë¡œ ë³µê·€
```

**Phase 5: Blue í™˜ê²½ ì •ë¦¬**
```bash
# Green ì•ˆì •í™” í™•ì¸ í›„ (24ì‹œê°„+)
kubectl delete deployment customer-api-blue -n ecommerce
kubectl label deployment customer-api-green version=v1.1.0 --overwrite

# ë‹¤ìŒ ë°°í¬ë¥¼ ìœ„í•´ Green â†’ Blueë¡œ ì¬ëª…ëª…
kubectl patch deployment customer-api-green -n ecommerce --type merge -p '
{
  "metadata": {"name": "customer-api-blue"}
}'
```

#### Kubernetes ë¦¬ì†ŒìŠ¤ ì˜ˆì‹œ

**DestinationRule (Blue/Green Subsets)**
```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: customer-api-dr
  namespace: ecommerce
spec:
  host: customer-api
  subsets:
    - name: blue
      labels:
        version: v1.0.0
      trafficPolicy:
        connectionPool:
          tcp:
            maxConnections: 100
          http:
            http1MaxPendingRequests: 50
            http2MaxRequests: 100
        outlierDetection:
          consecutive5xxErrors: 5
          interval: 10s
          baseEjectionTime: 30s
    
    - name: green
      labels:
        version: v1.1.0
      trafficPolicy:
        connectionPool:
          tcp:
            maxConnections: 100
          http:
            http1MaxPendingRequests: 50
            http2MaxRequests: 100
        outlierDetection:
          consecutive5xxErrors: 5
          interval: 10s
          baseEjectionTime: 30s
```

**VirtualService (Weight ê¸°ë°˜ ë¼ìš°íŒ…)**
```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: customer-api-vs
  namespace: ecommerce
spec:
  gateways:
    - ecommerce-gateway
  hosts:
    - api.c4ang.com
    - "*"
  http:
    - match:
        - uri:
            prefix: /api/v1/customers
      route:
        - destination:
            host: customer-api
            subset: blue
            port:
              number: 8080
          weight: 100  # â† Blue íŠ¸ë˜í”½ ë¹„ìœ¨
        - destination:
            host: customer-api
            subset: green
            port:
              number: 8080
          weight: 0    # â† Green íŠ¸ë˜í”½ ë¹„ìœ¨
      timeout: 30s
      retries:
        attempts: 3
        perTryTimeout: 10s
        retryOn: "5xx,reset,connect-failure,refused-stream"
```

**Deployment (Blue ë²„ì „)**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: customer-api-blue
  namespace: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: customer-api
      version: v1.0.0
  template:
    metadata:
      labels:
        app: customer-api
        version: v1.0.0  # â† DestinationRule subset ë§¤ì¹­
      annotations:
        sidecar.istio.io/inject: "true"
    spec:
      containers:
        - name: customer-api
          image: customer-api:1.0.0
          ports:
            - containerPort: 8080
```

**Deployment (Green ë²„ì „)**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: customer-api-green
  namespace: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: customer-api
      version: v1.1.0
  template:
    metadata:
      labels:
        app: customer-api
        version: v1.1.0  # â† DestinationRule subset ë§¤ì¹­
      annotations:
        sidecar.istio.io/inject: "true"
    spec:
      containers:
        - name: customer-api
          image: customer-api:1.1.0  # â† ìƒˆ ë²„ì „
          ports:
            - containerPort: 8080
```

#### Blue/Green vs Canary ë¹„êµ

| í•­ëª© | Blue/Green | Canary |
|------|-----------|--------|
| **íŠ¸ë˜í”½ ì „í™˜** | ì¦‰ì‹œ ì „í™˜ (0% â†’ 100%) | ì ì§„ì  ì „í™˜ (10% â†’ 50% â†’ 100%) |
| **ë¦¬ì†ŒìŠ¤ ì‚¬ìš©** | 2ë°° (Blue + Green ë™ì‹œ ìš´ì˜) | 1.1ë°° ~ 1.5ë°° |
| **ë¡¤ë°± ì†ë„** | ì¦‰ì‹œ (1-2ì´ˆ) | ì¦‰ì‹œ (1-2ì´ˆ) |
| **ìœ„í—˜ë„** | ì¤‘ê°„ (í•œ ë²ˆì— ì „í™˜) | ë‚®ìŒ (ì ì§„ì  ë…¸ì¶œ) |
| **ë³µì¡ë„** | ë‚®ìŒ | ì¤‘ê°„ |
| **ë¹„ìš©** | ë†’ìŒ (ë°°í¬ ì¤‘ 2ë°° ë¦¬ì†ŒìŠ¤) | ì¤‘ê°„ |
| **í…ŒìŠ¤íŠ¸ ì‹œê°„** | ì¶©ë¶„í•œ ì‹œê°„ í™•ë³´ ê°€ëŠ¥ | ì‹¤ì‹œê°„ í”„ë¡œë•ì…˜ ê²€ì¦ |
| **ì¶”ì²œ ìƒí™©** | ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ, ëŒ€ê·œëª¨ ë¦¬íŒ©í† ë§ | ì¼ë°˜ì ì¸ ê¸°ëŠ¥ ë°°í¬ |

#### ì¥ì 

1. **ì¦‰ì‹œ ë¡¤ë°± ê°€ëŠ¥**
   - VirtualService weightë§Œ ë³€ê²½
   - 1-2ì´ˆ ë‚´ ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µê·€

2. **ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ ì‹œê°„**
   - Green í™˜ê²½ì„ í”„ë¡œë•ì…˜ì— ë°°í¬í•œ ìƒíƒœë¡œ ë‚´ë¶€ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
   - íŠ¸ë˜í”½ ì „í™˜ ì „ ê²€ì¦ ì™„ë£Œ

3. **ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë™ì‘**
   - í•œ ë²ˆì— ì „í™˜ë˜ë¯€ë¡œ ë™ì‘ ì˜ˆì¸¡ ìš©ì´
   - ë‘ ë²„ì „ ë™ì‹œ ìš´ì˜ìœ¼ë¡œ ì¸í•œ ë³µì¡ë„ ë‚®ìŒ

4. **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¹œí™”ì **
   - ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ Blue/Greenì´ ìœ ë¦¬
   - Backward/Forward Compatibility ìœ ì§€í•˜ë©° ì „í™˜

#### ë‹¨ì 

1. **ë†’ì€ ë¦¬ì†ŒìŠ¤ ë¹„ìš©**
   - ë°°í¬ ì¤‘ 2ë°°ì˜ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ í•„ìš”
   - Pod, Memory, CPU ëª¨ë‘ ì¤‘ë³µ

2. **ì¦‰ì‹œ ì „í™˜ì˜ ìœ„í—˜**
   - 0% â†’ 100% ì „í™˜ ì‹œ ëª¨ë“  ì‚¬ìš©ìê°€ ë™ì‹œ ì˜í–¥
   - Canary ëŒ€ë¹„ ìœ„í—˜ë„ ë†’ìŒ

3. **ì¸í”„ë¼ ë³µì¡ë„**
   - Blue/Green í™˜ê²½ ê´€ë¦¬ í•„ìš”
   - ë„¤ì´ë°, ë¼ë²¨ë§ ì „ëµ í•„ìš”

#### ê¶Œì¥ ì‚¬í•­

**Blue/Green ì ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½
- ëŒ€ê·œëª¨ ì•„í‚¤í…ì²˜ ë¦¬íŒ©í† ë§
- ì™¸ë¶€ API ë²„ì „ ì—…ê·¸ë ˆì´ë“œ
- ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í•œ Critical ë³€ê²½

**Canary ì ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- ì¼ë°˜ì ì¸ ê¸°ëŠ¥ ì¶”ê°€/ìˆ˜ì •
- ë²„ê·¸ ìˆ˜ì •
- ì„±ëŠ¥ ê°œì„ 
- UI/UX ë³€ê²½

---

## ğŸ“Š ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

### Airflow on EKS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Namespace: airflow                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Airflow Components                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚  â”‚ Webserver   â”‚      â”‚  Scheduler  â”‚      â”‚  Worker 1   â”‚          â”‚  â”‚
â”‚  â”‚  â”‚ (UI)        â”‚      â”‚  (DAG ì‹¤í–‰) â”‚      â”‚  (Task ì‹¤í–‰)â”‚          â”‚  â”‚
â”‚  â”‚  â”‚ Port: 8080  â”‚      â”‚             â”‚      â”‚             â”‚          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚         â”‚                    â”‚                    â”‚                  â”‚  â”‚
â”‚  â”‚         â”‚                    â”‚                    â”‚                  â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚  â”‚                              â”‚                                        â”‚  â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
â”‚  â”‚                    â”‚  PostgreSQL       â”‚                             â”‚  â”‚
â”‚  â”‚                    â”‚  (Metadata DB)    â”‚                             â”‚  â”‚
â”‚  â”‚                    â”‚  - DAG ì •ë³´       â”‚                             â”‚  â”‚
â”‚  â”‚                    â”‚  - Task ìƒíƒœ      â”‚                             â”‚  â”‚
â”‚  â”‚                    â”‚  - ì‹¤í–‰ ì´ë ¥      â”‚                             â”‚  â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
â”‚  â”‚                              â”‚                                        â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚  â”‚         â”‚                    â”‚                    â”‚                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚  â”‚  Worker 2   â”‚      â”‚   Redis     â”‚      â”‚   Flower    â”‚          â”‚  â”‚
â”‚  â”‚  â”‚  (Task ì‹¤í–‰)â”‚      â”‚  (Celery    â”‚      â”‚  (Monitor)  â”‚          â”‚  â”‚
â”‚  â”‚  â”‚             â”‚      â”‚   Broker)   â”‚      â”‚  Port: 5555 â”‚          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚         â”‚                                                            â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜  â”‚
â”‚                                                                       â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â” â”‚
â”‚  â”‚                           DAGs (PVC)                               â”‚  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¤ â”‚
â”‚  â”‚                                                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  DAG 1: daily_recommendation_pipeline                        â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Schedule: ë§¤ì¼ 02:00 KST                                    â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Tasks:                                                      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  1. quality_check         (ë°ì´í„° í’ˆì§ˆ ì²´í¬)                 â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  2. calculate_metrics     (ë² ì´ì§€ì•ˆ ìŠ¤ë¬´ë”© ì¸ê¸°ë„ ê³„ì‚°)      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  3. calculate_similarity  (ì¹´í…Œê³ ë¦¬+ë¸Œëœë“œ ìœ ì‚¬ë„)           â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  4. hybrid_integration    (ì½˜í…ì¸ 70% + ì¸ê¸°ë„30%)            â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  5. store_recommendations (Top-10 ì €ì¥)                      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ì˜ˆìƒ ì†Œìš”ì‹œê°„: 30-45ë¶„                                      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚                                                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  DAG 2: weekly_sentiment_analysis                            â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Schedule: ë§¤ì£¼ ì¼ìš”ì¼ 03:00 KST                             â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Tasks:                                                      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  1. select_products           (ë¦¬ë·° 100+ ìƒí’ˆ ì„ ì •)          â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  2. analyze_sentiment_batch   (Lambda í˜¸ì¶œ)                  â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  3. store_sentiment_results   (ê°ì • ì ìˆ˜ ì €ì¥)               â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  ì˜ˆìƒ ì†Œìš”ì‹œê°„: 20-30ë¶„                                      â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚                                                                    â”‚  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                   â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                   â”‚                   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  AWS RDS            â”‚  â”‚  AWS Lambda  â”‚  â”‚  Recommendation   â”‚
   â”‚  (PostgreSQL)       â”‚  â”‚  (Sentiment  â”‚  â”‚  Service API      â”‚
   â”‚                     â”‚  â”‚   Analysis)  â”‚  â”‚  (ì†Œë¹„)           â”‚
   â”‚  Tables:            â”‚  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚  - purchases        â”‚  â”‚  Model:      â”‚
   â”‚  - products         â”‚  â”‚  HuggingFace â”‚
   â”‚  - reviews          â”‚  â”‚  Korean BERT â”‚
   â”‚  - recommendations  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚  - sentiment        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

#### ì¶”ì²œ íŒŒì´í”„ë¼ì¸ (ì¼ë³„)

```
02:00 KST - DAG ì‹œì‘
     â”‚
     â–¼
1. quality_check (PostgresOperator)
   SELECT COUNT(*) FROM purchases WHERE date = YESTERDAY
   â†’ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
     â”‚
     â–¼
2. calculate_metrics (PythonOperator)
   - ë² ì´ì§€ì•ˆ ìŠ¤ë¬´ë”© ì ìš© ì¸ê¸°ë„ ê³„ì‚°
   - ê³µì‹: (êµ¬ë§¤ìˆ˜ + Î±) / (ì´êµ¬ë§¤ìˆ˜ + Î± + Î²)
   - Î±=5, Î²=45 (ì‚¬ì „ í™•ë¥ )
   - ê²°ê³¼: product_id, popularity_score
     â”‚
     â–¼
3. calculate_similarity (PythonOperator)
   - ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ìœ ì‚¬ë„: ê°™ì€ ì¹´í…Œê³ ë¦¬ = 1, ë‹¤ë¦„ = 0
   - ë¸Œëœë“œ ê¸°ë°˜ ìœ ì‚¬ë„: ê°™ì€ ë¸Œëœë“œ = 1, ë‹¤ë¦„ = 0
   - ìµœì¢… ìœ ì‚¬ë„: (ì¹´í…Œê³ ë¦¬ + ë¸Œëœë“œ) / 2
   - ê²°ê³¼: product_a, product_b, similarity_score
     â”‚
     â–¼
4. hybrid_integration (PythonOperator)
   - ê° ìƒí’ˆì— ëŒ€í•´:
     FOR product_a IN products:
       FOR product_b IN products WHERE product_b != product_a:
         score = content_similarity(a,b) * 0.7 + popularity(b) * 0.3
       TOP_10 = ORDER BY score DESC LIMIT 10
   - ê²°ê³¼: product_id, recommended_products[]
     â”‚
     â–¼
5. store_recommendations (PostgresOperator)
   INSERT INTO recommendations (product_id, recommended_ids, scores, created_at)
   VALUES (...)
   ON CONFLICT (product_id) DO UPDATE
     â”‚
     â–¼
02:45 - DAG ì™„ë£Œ
```

#### ê°ì •ë¶„ì„ íŒŒì´í”„ë¼ì¸ (ì£¼ê°„)

```
ì¼ìš”ì¼ 03:00 KST - DAG ì‹œì‘
     â”‚
     â–¼
1. select_products (PostgresOperator)
   SELECT product_id, COUNT(reviews) as review_count
   FROM reviews
   WHERE created_at > NOW() - INTERVAL '30 days'
   GROUP BY product_id
   HAVING review_count >= 100
   AND product_id NOT IN (
     SELECT product_id FROM sentiment 
     WHERE created_at > NOW() - INTERVAL '30 days'
   )
   ORDER BY review_count DESC
   LIMIT 10
     â”‚
     â–¼
2. analyze_sentiment_batch (PythonOperator + Lambda)
   FOR product IN selected_products:
     reviews = fetch_reviews(product_id)
     
     # Lambda ë°°ì¹˜ í˜¸ì¶œ (32ê°œì”©)
     FOR batch IN chunk(reviews, 32):
       response = lambda_client.invoke(
         FunctionName='sentiment-analysis',
         Payload={
           'reviews': batch
         }
       )
       sentiments.extend(response['sentiments'])
     
     # ì§‘ê³„
     positive = COUNT WHERE sentiment > 0
     negative = COUNT WHERE sentiment < 0
     avg_score = AVG(sentiment)
     
     results[product_id] = {
       'positive_ratio': positive / total,
       'negative_ratio': negative / total,
       'avg_sentiment': avg_score
     }
     â”‚
     â–¼
3. store_sentiment_results (PostgresOperator)
   INSERT INTO sentiment (
     product_id, 
     positive_ratio, 
     negative_ratio, 
     avg_sentiment, 
     analyzed_at
   )
   VALUES (...)
     â”‚
     â–¼
03:30 - DAG ì™„ë£Œ
```

### Lambda í•¨ìˆ˜ (Sentiment Analysis)

```python
# AWS Lambda Function
# Runtime: Python 3.11
# Memory: 4096 MB
# Timeout: 600s
# Image: ECR Container Image

import torch
from transformers import AutoTokenizer, AutoModelForSequenceClassification

# ëª¨ë¸ ì´ˆê¸°í™” (Cold Start ì‹œ í•œ ë²ˆë§Œ)
tokenizer = AutoTokenizer.from_pretrained("beomi/kcbert-base")
model = AutoModelForSequenceClassification.from_pretrained("beomi/kcbert-base")

def handler(event, context):
    """
    Input:
      {
        "reviews": [
          "ì •ë§ ì¢‹ì€ ìƒí’ˆì´ì—ìš”!",
          "ë°°ì†¡ì´ ë„ˆë¬´ ëŠ¦ì–´ìš”...",
          ...
        ]
      }
    
    Output:
      {
        "sentiments": [
          0.92,   # -1 (ë¶€ì •) ~ +1 (ê¸ì •)
          -0.65,
          ...
        ]
      }
    """
    reviews = event['reviews']
    
    # ë°°ì¹˜ ì²˜ë¦¬
    inputs = tokenizer(reviews, padding=True, truncation=True, return_tensors="pt")
    
    with torch.no_grad():
        outputs = model(**inputs)
        predictions = torch.nn.functional.softmax(outputs.logits, dim=-1)
    
    # -1 ~ +1 ì •ê·œí™”
    sentiments = (predictions[:, 1] - predictions[:, 0]).tolist()
    
    return {
        'sentiments': sentiments
    }
```

---

## ğŸ”’ ë³´ì•ˆ ì•„í‚¤í…ì²˜

### Secrets ê´€ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Git Repository (Public)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Encrypted Secrets (SOPS + AGE)                                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  values.secrets.yaml (ì•”í˜¸í™”ë¨)                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ database:                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   password: ENC[AES256_GCM,data:...,iv:...,tag:...,type:str]   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ redis:                                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   password: ENC[AES256_GCM,data:...,iv:...,tag:...,type:str]   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ jwt:                                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   secret: ENC[AES256_GCM,data:...,iv:...,tag:...,type:str]     â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  .sops.yaml (ì•”í˜¸í™” ê·œì¹™)                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ creation_rules:                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   - path_regex: \.secrets\.yaml$                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     age: age1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ git clone
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Developer Workstation / CI/CD     â”‚
                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                â”‚                                     â”‚
                â”‚  AGE Private Key (ë¡œì»¬ ì €ì¥)        â”‚
                â”‚  ~/.config/sops/age/keys.txt       â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚  â”‚ AGE-SECRET-KEY-1XXXXXXXXXXXXX â”‚ â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚                                     â”‚
                â”‚  Decrypt ëª…ë ¹                       â”‚
                â”‚  $ sops -d values.secrets.yaml     â”‚
                â”‚                                     â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                â”‚  â”‚ database:                     â”‚ â”‚
                â”‚  â”‚   password: "my-db-password"  â”‚ â”‚
                â”‚  â”‚ redis:                        â”‚ â”‚
                â”‚  â”‚   password: "my-redis-pwd"    â”‚ â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                â”‚                                     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ kubectl apply
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EKS Cluster               â”‚                                                â”‚
â”‚                            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           External Secrets Operator (ì„ íƒì‚¬í•­)                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  SecretStore                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ apiVersion: external-secrets.io/v1beta1                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ kind: SecretStore                                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ metadata:                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   name: aws-secrets-manager                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ spec:                                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   provider:                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     aws:                                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚       service: SecretsManager                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚       region: ap-northeast-2                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚       auth:                                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚         jwt:                                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚           serviceAccountRef:                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚             name: external-secrets-sa                           â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  ExternalSecret                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ apiVersion: external-secrets.io/v1beta1                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ kind: ExternalSecret                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ metadata:                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   name: app-secrets                                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ spec:                                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   secretStoreRef:                                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     name: aws-secrets-manager                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   target:                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     name: app-secrets                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   data:                                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - secretKey: db-password                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚       remoteRef:                                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚         key: c4ang/production/database                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚         property: password                                      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                            â”‚                                          â”‚  â”‚
â”‚  â”‚                            â–¼                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Kubernetes Secret (ìë™ ìƒì„±)                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ apiVersion: v1                                            â”‚  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ kind: Secret                                              â”‚  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ metadata:                                                 â”‚  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   name: app-secrets                                       â”‚  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ data:                                                     â”‚  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   db-password: bXktZGItcGFzc3dvcmQ=                       â”‚  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                            â”‚                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Pod (customer-api)                                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ env:                                                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   - name: DB_PASSWORD                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     valueFrom:                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚       secretKeyRef:                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         name: app-secrets                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         key: db-password                                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IAM ë° RBAC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AWS IAM                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  EKS Node Role                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Policies:                                                   â”‚ â”‚
â”‚  â”‚ - AmazonEKSWorkerNodePolicy                                 â”‚ â”‚
â”‚  â”‚ - AmazonEKS_CNI_Policy                                      â”‚ â”‚
â”‚  â”‚ - AmazonEC2ContainerRegistryReadOnly                        â”‚ â”‚
â”‚  â”‚ - AmazonEBSCSIDriverPolicy                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Airflow ServiceAccount Role (IRSA)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Trust Policy:                                               â”‚ â”‚
â”‚  â”‚   - eks.amazonaws.com (OIDC)                                â”‚ â”‚
â”‚  â”‚ Permissions:                                                â”‚ â”‚
â”‚  â”‚   - Lambda: InvokeFunction                                  â”‚ â”‚
â”‚  â”‚   - RDS: Connect                                            â”‚ â”‚
â”‚  â”‚   - S3: GetObject, PutObject                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  External Secrets Operator Role (IRSA)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Trust Policy:                                               â”‚ â”‚
â”‚  â”‚   - eks.amazonaws.com (OIDC)                                â”‚ â”‚
â”‚  â”‚ Permissions:                                                â”‚ â”‚
â”‚  â”‚   - SecretsManager: GetSecretValue                          â”‚ â”‚
â”‚  â”‚   - SecretsManager: DescribeSecret                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes RBAC                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ClusterRole: istio-reader                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ rules:                                                      â”‚ â”‚
â”‚  â”‚   - apiGroups: [""]                                         â”‚ â”‚
â”‚  â”‚     resources: ["services", "endpoints", "pods"]            â”‚ â”‚
â”‚  â”‚     verbs: ["get", "list", "watch"]                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Role: airflow-admin (airflow namespace)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ rules:                                                      â”‚ â”‚
â”‚  â”‚   - apiGroups: [""]                                         â”‚ â”‚
â”‚  â”‚     resources: ["pods", "pods/log"]                         â”‚ â”‚
â”‚  â”‚     verbs: ["get", "list", "create", "delete"]              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Role: developer (ecommerce namespace)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ rules:                                                      â”‚ â”‚
â”‚  â”‚   - apiGroups: ["apps"]                                     â”‚ â”‚
â”‚  â”‚     resources: ["deployments"]                              â”‚ â”‚
â”‚  â”‚     verbs: ["get", "list", "patch"]                         â”‚ â”‚
â”‚  â”‚   - apiGroups: [""]                                         â”‚ â”‚
â”‚  â”‚     resources: ["pods", "pods/log"]                         â”‚ â”‚
â”‚  â”‚     verbs: ["get", "list"]                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AWS Security Groups                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  NLB Security Group                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Inbound:                                                    â”‚ â”‚
â”‚  â”‚   - Port 80 from 0.0.0.0/0 (HTTP)                           â”‚ â”‚
â”‚  â”‚   - Port 443 from 0.0.0.0/0 (HTTPS)                         â”‚ â”‚
â”‚  â”‚ Outbound:                                                   â”‚ â”‚
â”‚  â”‚   - All traffic to EKS Worker Nodes                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  EKS Worker Nodes Security Group                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Inbound:                                                    â”‚ â”‚
â”‚  â”‚   - Port 80, 443 from NLB Security Group                    â”‚ â”‚
â”‚  â”‚   - All traffic from same Security Group (Node-to-Node)     â”‚ â”‚
â”‚  â”‚   - Port 443 from Control Plane Security Group             â”‚ â”‚
â”‚  â”‚ Outbound:                                                   â”‚ â”‚
â”‚  â”‚   - All traffic                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  RDS Security Group                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Inbound:                                                    â”‚ â”‚
â”‚  â”‚   - Port 5432 from EKS Worker Nodes Security Group          â”‚ â”‚
â”‚  â”‚ Outbound:                                                   â”‚ â”‚
â”‚  â”‚   - None                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Network Policies (ì˜ˆì •)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  ecommerce namespace                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ apiVersion: networking.k8s.io/v1                            â”‚ â”‚
â”‚  â”‚ kind: NetworkPolicy                                         â”‚ â”‚
â”‚  â”‚ metadata:                                                   â”‚ â”‚
â”‚  â”‚   name: allow-ingress-to-services                           â”‚ â”‚
â”‚  â”‚ spec:                                                       â”‚ â”‚
â”‚  â”‚   podSelector:                                              â”‚ â”‚
â”‚  â”‚     matchLabels:                                            â”‚ â”‚
â”‚  â”‚       app: microservice                                     â”‚ â”‚
â”‚  â”‚   policyTypes:                                              â”‚ â”‚
â”‚  â”‚     - Ingress                                               â”‚ â”‚
â”‚  â”‚   ingress:                                                  â”‚ â”‚
â”‚  â”‚     - from:                                                 â”‚ â”‚
â”‚  â”‚         - namespaceSelector:                                â”‚ â”‚
â”‚  â”‚             matchLabels:                                    â”‚ â”‚
â”‚  â”‚               name: istio-system                            â”‚ â”‚
â”‚  â”‚         - podSelector:                                      â”‚ â”‚
â”‚  â”‚             matchLabels:                                    â”‚ â”‚
â”‚  â”‚               app: microservice                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ í™˜ê²½ë³„ êµ¬ì„±

### ê°œë°œ í™˜ê²½ (Local K3d)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Developer Workstation                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  K3d Cluster (Single Node)                                           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Namespaces:                                                          â”‚  â”‚
â”‚  â”‚  - ecommerce    (ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤)                                      â”‚  â”‚
â”‚  â”‚  - airflow      (ë°ì´í„° íŒŒì´í”„ë¼ì¸)                                  â”‚  â”‚
â”‚  â”‚  - istio-system (Service Mesh)                                        â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Storage:                                                             â”‚  â”‚
â”‚  â”‚  - local-path (K3d ê¸°ë³¸ StorageClass)                                â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Services:                                                            â”‚  â”‚
â”‚  â”‚  - 6 Microservices (ê° 1 replica)                                     â”‚  â”‚
â”‚  â”‚  - PostgreSQL (StatefulSet, ë‚´ì¥)                                    â”‚  â”‚
â”‚  â”‚  - Redis (StatefulSet, ë‚´ì¥)                                         â”‚  â”‚
â”‚  â”‚  - Airflow (ê°„ì†Œí™” ë²„ì „)                                              â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  External Access:                                                     â”‚  â”‚
â”‚  â”‚  - Port Forward (kubectl port-forward)                                â”‚  â”‚
â”‚  â”‚  - NodePort (30000-32767)                                             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  Quick Start:                                                                â”‚
â”‚  ```                                                                         â”‚
â”‚  cd k8s-dev-k3d                                                              â”‚
â”‚  ./scripts/start-environment.sh                                              â”‚
â”‚  ```                                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìŠ¤í…Œì´ì§• í™˜ê²½ (EKS - ì˜ˆì •)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS EKS (Staging)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  EKS Cluster: c4ang-staging                                                  â”‚
â”‚  Region: ap-northeast-2                                                      â”‚
â”‚  Nodes: 2 (Single AZ)                                                        â”‚
â”‚                                                                              â”‚
â”‚  Services:                                                                   â”‚
â”‚  - 6 Microservices (ê° 1 replica)                                            â”‚
â”‚  - RDS PostgreSQL (db.t3.micro)                                              â”‚
â”‚  - ElastiCache Redis (cache.t3.micro) - ì„ íƒ                                 â”‚
â”‚  - Airflow (Worker 1ê°œ)                                                      â”‚
â”‚                                                                              â”‚
â”‚  Differences from Production:                                                â”‚
â”‚  - Single AZ (ë¹„ìš© ì ˆê°)                                                     â”‚
â”‚  - ì‘ì€ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…                                                         â”‚
â”‚  - HPA ë¹„í™œì„±í™”                                                              â”‚
â”‚  - ëª¨ë‹ˆí„°ë§ ê°„ì†Œí™”                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í”„ë¡œë•ì…˜ í™˜ê²½ (EKS - í˜„ì¬)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS EKS (Production)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  EKS Cluster: c4ang-production                                               â”‚
â”‚  Region: ap-northeast-2                                                      â”‚
â”‚  Nodes: 3+ (Multi-AZ: 2a, 2b, 2c)                                            â”‚
â”‚                                                                              â”‚
â”‚  Services:                                                                   â”‚
â”‚  - 6 Microservices (ê° 2+ replicas)                                          â”‚
â”‚  - RDS PostgreSQL (Multi-AZ, db.r5.large)                                    â”‚
â”‚  - Redis StatefulSet (ë‚´ì¥, í–¥í›„ ElastiCache ì „í™˜)                           â”‚
â”‚  - Airflow (Worker 2+ê°œ)                                                     â”‚
â”‚                                                                              â”‚
â”‚  High Availability:                                                          â”‚
â”‚  - Multi-AZ ë°°í¬                                                             â”‚
â”‚  - HPA í™œì„±í™” (2-10 replicas)                                                â”‚
â”‚  - PodDisruptionBudget ì„¤ì •                                                  â”‚
â”‚  - RDS Multi-AZ Failover                                                     â”‚
â”‚                                                                              â”‚
â”‚  Monitoring:                                                                 â”‚
â”‚  - Prometheus + Grafana                                                      â”‚
â”‚  - Kiali (Service Mesh Dashboard)                                            â”‚
â”‚  - Jaeger (Distributed Tracing)                                              â”‚
â”‚  - CloudWatch Logs + Metrics                                                 â”‚
â”‚                                                                              â”‚
â”‚  Security:                                                                   â”‚
â”‚  - mTLS (STRICT mode)                                                        â”‚
â”‚  - Network Policies                                                          â”‚
â”‚  - External Secrets Operator                                                 â”‚
â”‚  - WAF + Rate Limiting                                                       â”‚
â”‚                                                                              â”‚
â”‚  Backup:                                                                     â”‚
â”‚  - RDS Automated Backups (7ì¼ ë³´ê´€)                                          â”‚
â”‚  - Velero (Kubernetes ë°±ì—…, ì£¼ê°„)                                            â”‚
â”‚  - Redis Snapshot (ì¼ë³„)                                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í™˜ê²½ë³„ ë¹„êµ

| í•­ëª© | ë¡œì»¬ (K3d) | ìŠ¤í…Œì´ì§• (EKS) | í”„ë¡œë•ì…˜ (EKS) |
|------|------------|---------------|---------------|
| **ì¸í”„ë¼** |
| Cluster | K3d (Docker) | EKS | EKS |
| Nodes | 1 | 2 (Single AZ) | 3+ (Multi-AZ) |
| Instance Type | - | t3.medium | t3.large+ |
| **ë°ì´í„°ë² ì´ìŠ¤** |
| PostgreSQL | StatefulSet | RDS (Single-AZ) | RDS (Multi-AZ) |
| Redis | StatefulSet | StatefulSet | StatefulSet (â†’ ElastiCache) |
| **ì„œë¹„ìŠ¤** |
| Replicas | 1 | 1 | 2+ |
| HPA | âŒ | âŒ | âœ… (2-10) |
| Istio | âœ… | âœ… | âœ… |
| Airflow Workers | 1 | 1 | 2+ |
| **ë³´ì•ˆ** |
| mTLS | âŒ | âœ… (PERMISSIVE) | âœ… (STRICT) |
| Network Policy | âŒ | âœ… | âœ… |
| WAF | âŒ | âŒ | âœ… |
| Secrets | SOPS | SOPS + ESO | ESO (AWS Secrets) |
| **ëª¨ë‹ˆí„°ë§** |
| Prometheus | âŒ | âœ… (ê°„ì†Œí™”) | âœ… |
| Grafana | âŒ | âœ… | âœ… |
| Kiali | âœ… (ë¡œì»¬) | âœ… | âœ… |
| Jaeger | âŒ | âœ… | âœ… |
| **ë¹„ìš© (ì›”)** | ë¬´ë£Œ | ~$200 | ~$800 |

---

## ğŸ“¦ ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤

#### 1. Customer Service
- **ì—­í• **: ê³ ê° ì •ë³´ ê´€ë¦¬ (CRUD)
- **API ê²½ë¡œ**: `/api/v1/customers`
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (customers í…Œì´ë¸”)
- **ìºì‹œ**: Redis (ê³ ê° í”„ë¡œí•„)
- **ì˜ì¡´ì„±**: ì—†ìŒ

#### 2. Order Service
- **ì—­í• **: ì£¼ë¬¸ ê´€ë¦¬ ë° ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- **API ê²½ë¡œ**: `/api/v1/orders`
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (orders, order_items í…Œì´ë¸”)
- **ì˜ì¡´ì„±**:
  - Customer Service (ê³ ê° ì •ë³´ ì¡°íšŒ)
  - Product Service (ìƒí’ˆ ì¬ê³  í™•ì¸)
  - Payment Service (ê²°ì œ ì²˜ë¦¬)
  - Saga Tracker (ë¶„ì‚° íŠ¸ëœì­ì…˜ ì¶”ì )

#### 3. Product Service
- **ì—­í• **: ìƒí’ˆ ì¹´íƒˆë¡œê·¸ ê´€ë¦¬
- **API ê²½ë¡œ**: `/api/v1/products`
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (products, categories í…Œì´ë¸”)
- **ìºì‹œ**: Redis (ìƒí’ˆ ëª©ë¡, ê²€ìƒ‰ ê²°ê³¼)
- **ì˜ì¡´ì„±**: Recommendation Service (ì¶”ì²œ ë°ì´í„° ì†Œë¹„)

#### 4. Payment Service
- **ì—­í• **: ê²°ì œ ì²˜ë¦¬ (PG ì—°ë™)
- **API ê²½ë¡œ**: `/api/v1/payments`
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (payments í…Œì´ë¸”)
- **ì™¸ë¶€ ì—°ë™**: PGì‚¬ API (í† ìŠ¤í˜ì´ë¨¼ì¸ , ì´ë‹ˆì‹œìŠ¤ ë“±)
- **ì˜ì¡´ì„±**: Order Service (ì£¼ë¬¸ ì •ë³´)

#### 5. Recommendation Service
- **ì—­í• **: ìƒí’ˆ ì¶”ì²œ API ì œê³µ
- **API ê²½ë¡œ**: `/api/v1/recommendations`
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (recommendations í…Œì´ë¸” - read only)
- **ìºì‹œ**: Redis (ì¶”ì²œ ê²°ê³¼)
- **ë°ì´í„° ì†ŒìŠ¤**: Airflow DAGì—ì„œ ìƒì„±í•œ ì¶”ì²œ ë°ì´í„°

#### 6. Saga Tracker
- **ì—­í• **: ë¶„ì‚° íŠ¸ëœì­ì…˜ ëª¨ë‹ˆí„°ë§ ë° ë³´ìƒ íŠ¸ëœì­ì…˜
- **API ê²½ë¡œ**: `/api/v1/saga`
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (saga_instances, saga_events í…Œì´ë¸”)
- **íŒ¨í„´**: Saga Orchestration Pattern
- **ì˜ì¡´ì„±**: Order, Payment, Product Service (ë³´ìƒ íŠ¸ëœì­ì…˜ í˜¸ì¶œ)

### ë°ì´í„° ì €ì¥ì†Œ

#### PostgreSQL (AWS RDS)
- **ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…**: db.r5.large (í”„ë¡œë•ì…˜)
- **ì—”ì§„ ë²„ì „**: PostgreSQL 15
- **Multi-AZ**: í™œì„±í™”
- **Backup**: ìë™ ë°±ì—… 7ì¼ ë³´ê´€
- **ìŠ¤í‚¤ë§ˆ**:
  ```sql
  -- customers
  CREATE TABLE customers (
    customer_id UUID PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(100),
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
  );

  -- products
  CREATE TABLE products (
    product_id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    category VARCHAR(100),
    brand VARCHAR(100),
    price DECIMAL(10,2),
    stock INTEGER,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
  );

  -- orders
  CREATE TABLE orders (
    order_id UUID PRIMARY KEY,
    customer_id UUID REFERENCES customers(customer_id),
    total_amount DECIMAL(10,2),
    status VARCHAR(20), -- PENDING, PAID, SHIPPED, DELIVERED, CANCELLED
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
  );

  -- order_items
  CREATE TABLE order_items (
    order_item_id UUID PRIMARY KEY,
    order_id UUID REFERENCES orders(order_id),
    product_id UUID REFERENCES products(product_id),
    quantity INTEGER,
    price DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT NOW()
  );

  -- payments
  CREATE TABLE payments (
    payment_id UUID PRIMARY KEY,
    order_id UUID REFERENCES orders(order_id),
    amount DECIMAL(10,2),
    status VARCHAR(20), -- PENDING, APPROVED, FAILED, REFUNDED
    pg_transaction_id VARCHAR(100),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
  );

  -- recommendations (Airflowì—ì„œ ìƒì„±)
  CREATE TABLE recommendations (
    product_id UUID PRIMARY KEY,
    recommended_product_ids UUID[],
    scores FLOAT[],
    algorithm VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
  );

  -- sentiment (Airflowì—ì„œ ìƒì„±)
  CREATE TABLE sentiment (
    product_id UUID PRIMARY KEY,
    positive_ratio FLOAT,
    negative_ratio FLOAT,
    avg_sentiment FLOAT,
    analyzed_at TIMESTAMP DEFAULT NOW()
  );

  -- saga_instances
  CREATE TABLE saga_instances (
    saga_id UUID PRIMARY KEY,
    saga_type VARCHAR(50),
    status VARCHAR(20), -- STARTED, COMPLETED, FAILED, COMPENSATING
    payload JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
  );

  -- saga_events
  CREATE TABLE saga_events (
    event_id UUID PRIMARY KEY,
    saga_id UUID REFERENCES saga_instances(saga_id),
    step VARCHAR(50),
    event_type VARCHAR(20), -- STEP_STARTED, STEP_COMPLETED, STEP_FAILED
    payload JSONB,
    created_at TIMESTAMP DEFAULT NOW()
  );
  ```

#### Redis (StatefulSet)
- **ìš©ë„**:
  - Session Store (ê³ ê° ì„¸ì…˜)
  - Cache (ìƒí’ˆ ëª©ë¡, ì¶”ì²œ ê²°ê³¼)
  - Celery Broker (Airflow)
- **Persistence**: AOF + RDB
- **Storage**: 8Gi EBS Volume
- **í–¥í›„ ê³„íš**: AWS ElastiCacheë¡œ ì „í™˜

### ê´€ë¦¬ ì„œë¹„ìŠ¤

#### Apache Airflow
- **ë²„ì „**: 2.x
- **Executor**: CeleryExecutor
- **ì»´í¬ë„ŒíŠ¸**:
  - Webserver (UI)
  - Scheduler (DAG ìŠ¤ì¼€ì¤„ë§)
  - WorkerÃ—2 (Task ì‹¤í–‰)
  - PostgreSQL (Metadata DB)
  - Redis (Celery Broker)
  - Flower (ëª¨ë‹ˆí„°ë§)
- **DAGs**:
  - `daily_recommendation_pipeline` (ë§¤ì¼ 02:00)
  - `weekly_sentiment_analysis` (ì¼ìš”ì¼ 03:00)

#### Istio
- **ë²„ì „**: 1.28.0
- **í”„ë¡œí•„**: default
- **ì»´í¬ë„ŒíŠ¸**:
  - istiod (Control Plane)
  - Ingress Gateway
  - Egress Gateway (ì„ íƒ)
- **ê¸°ëŠ¥**:
  - ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…
  - Retry & Timeout
  - Circuit Breaker
  - mTLS (ì˜ˆì •)
  - Observability (Kiali, Grafana, Jaeger)

### AWS ì„œë¹„ìŠ¤

#### AWS Lambda (Sentiment Analysis)
- **Runtime**: Python 3.11 (Container Image)
- **Memory**: 4096 MB
- **Timeout**: 600ì´ˆ
- **Trigger**: Airflow (ìˆ˜ë™ í˜¸ì¶œ)
- **ëª¨ë¸**: HuggingFace BERT (í•œêµ­ì–´ ê°ì •ë¶„ì„)

#### AWS RDS (PostgreSQL)
- **ì—”ì§„**: PostgreSQL 15
- **ì¸ìŠ¤í„´ìŠ¤**: db.r5.large
- **Multi-AZ**: í™œì„±í™”
- **Storage**: 100 GB (gp3, Auto Scaling)
- **Backup**: 7ì¼ ìë™ ë°±ì—…

#### AWS Network Load Balancer
- **Type**: network
- **Scheme**: internet-facing
- **Target**: IP (Istio Ingress Gateway Pods)
- **Health Check**: HTTP /healthz
- **Multi-AZ**: 3ê°œ AZì— ë¶„ì‚°

---

## ğŸ“Š íŠ¸ë˜í”½ ë° ìš©ëŸ‰ ê³„íš

### ì˜ˆìƒ íŠ¸ë˜í”½ (í”„ë¡œë•ì…˜)

| í•­ëª© | ì¼ë³„ | ì´ˆë‹¹ (í‰ê· ) | ì´ˆë‹¹ (í”¼í¬) |
|------|------|------------|------------|
| ê³ ê° ì¡°íšŒ | 100,000 | 1.2 | 10 |
| ìƒí’ˆ ì¡°íšŒ | 500,000 | 5.8 | 50 |
| ì£¼ë¬¸ ìƒì„± | 10,000 | 0.12 | 2 |
| ê²°ì œ ì²˜ë¦¬ | 9,000 | 0.10 | 1.5 |
| ì¶”ì²œ ì¡°íšŒ | 50,000 | 0.58 | 5 |

### ìŠ¤ì¼€ì¼ë§ ì •ì±… (HPA)

```yaml
# ì˜ˆì‹œ: order-service HPA
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: order-api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: order-api
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Pods
          value: 1
          periodSeconds: 60
```

---

## ğŸ”„ CI/CD íŒŒì´í”„ë¼ì¸ (Blue/Green ë°°í¬)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GitHub Actions Workflow                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 1: Build & Test                                              â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  1. Code Push â†’ main branch                                         â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  2. Run Tests                                                        â”‚    â”‚
â”‚  â”‚     â”œâ”€ Unit Tests                                                    â”‚    â”‚
â”‚  â”‚     â”œâ”€ Integration Tests                                             â”‚    â”‚
â”‚  â”‚     â””â”€ E2E Tests                                                     â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  3. Build Docker Image                                               â”‚    â”‚
â”‚  â”‚     - Tag: customer-api:${GIT_SHA}                                   â”‚    â”‚
â”‚  â”‚     - Tag: customer-api:v1.1.0                                       â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  4. Security Scan                                                    â”‚    â”‚
â”‚  â”‚     â”œâ”€ Trivy (ì´ë¯¸ì§€ ì·¨ì•½ì )                                         â”‚    â”‚
â”‚  â”‚     â”œâ”€ Snyk (ì˜ì¡´ì„± ì·¨ì•½ì )                                          â”‚    â”‚
â”‚  â”‚     â””â”€ Hadolint (Dockerfile ë¦°íŠ¸)                                    â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  5. Push to ECR                                                      â”‚    â”‚
â”‚  â”‚     - Registry: xxx.dkr.ecr.ap-northeast-2.amazonaws.com             â”‚    â”‚
â”‚  â”‚     - Image: customer-api:v1.1.0                                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 2: Green í™˜ê²½ ë°°í¬ (Blue ìš´ì˜ ì¤‘)                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  6. Update Helm Chart                                                â”‚    â”‚
â”‚  â”‚     - values-green.yaml ìƒì„±                                         â”‚    â”‚
â”‚  â”‚     - image.tag: v1.1.0                                              â”‚    â”‚
â”‚  â”‚     - labels.version: v1.1.0                                         â”‚    â”‚
â”‚  â”‚     - deployment.name: customer-api-green                            â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  7. Deploy Green Environment                                         â”‚    â”‚
â”‚  â”‚     $ helm upgrade customer-api-green ./helm/customer-service \      â”‚    â”‚
â”‚  â”‚         -f values-green.yaml -n ecommerce --install                  â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  8. Wait for Green Pods Ready                                        â”‚    â”‚
â”‚  â”‚     $ kubectl wait --for=condition=ready pod \                       â”‚    â”‚
â”‚  â”‚         -l version=v1.1.0 -n ecommerce --timeout=5m                  â”‚    â”‚
â”‚  â”‚     â”‚                                                                â”‚    â”‚
â”‚  â”‚     â–¼                                                                â”‚    â”‚
â”‚  â”‚  9. Internal Health Check (Green ì§ì ‘ í˜¸ì¶œ)                          â”‚    â”‚
â”‚  â”‚     - Health Endpoint: /actuator/health                              â”‚    â”‚
â”‚  â”‚     - Readiness Check: OK                                            â”‚    â”‚
â”‚  â”‚     - Liveness Check: OK                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 3: Green ê²€ì¦ (íŠ¸ë˜í”½ ì „í™˜ ì „)                                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  10. Smoke Tests on Green                                            â”‚    â”‚
â”‚  â”‚      â”œâ”€ API Endpoint í…ŒìŠ¤íŠ¸                                          â”‚    â”‚
â”‚  â”‚      â”œâ”€ Database Connection í™•ì¸                                     â”‚    â”‚
â”‚  â”‚      â”œâ”€ Redis Connection í™•ì¸                                        â”‚    â”‚
â”‚  â”‚      â””â”€ External API ì—°ë™ í™•ì¸                                       â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  11. Integration Tests on Green                                      â”‚    â”‚
â”‚  â”‚      - Green í™˜ê²½ì—ì„œ ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸                            â”‚    â”‚
â”‚  â”‚      - ì£¼ë¬¸ ìƒì„± â†’ ê²°ì œ ì²˜ë¦¬ â†’ ë°°ì†¡ ì‹œì‘ í”Œë¡œìš°                      â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  12. Manual Approval (ì„ íƒ)                                          â”‚    â”‚
â”‚  â”‚      â¸  íŒ€ ë¦¬ë“œ ìŠ¹ì¸ ëŒ€ê¸° (Slack ì•Œë¦¼)                               â”‚    â”‚
â”‚  â”‚      â¸  Green í™˜ê²½ ì¶©ë¶„íˆ ê²€ì¦ ì™„ë£Œ                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 4: íŠ¸ë˜í”½ ì „í™˜ (Blue â†’ Green)                                 â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  13. Update VirtualService (ì¦‰ì‹œ ì „í™˜)                               â”‚    â”‚
â”‚  â”‚      $ kubectl patch virtualservice customer-api-vs \                â”‚    â”‚
â”‚  â”‚          -n ecommerce --type merge -p '{                             â”‚    â”‚
â”‚  â”‚            "spec": {                                                 â”‚    â”‚
â”‚  â”‚              "http": [{                                              â”‚    â”‚
â”‚  â”‚                "route": [                                            â”‚    â”‚
â”‚  â”‚                  {"destination": {"subset": "blue"}, "weight": 0},   â”‚    â”‚
â”‚  â”‚                  {"destination": {"subset": "green"}, "weight": 100} â”‚    â”‚
â”‚  â”‚                ]                                                     â”‚    â”‚
â”‚  â”‚              }]                                                      â”‚    â”‚
â”‚  â”‚            }                                                         â”‚    â”‚
â”‚  â”‚          }'                                                          â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â”‚  âš¡ íŠ¸ë˜í”½ 100% Greenìœ¼ë¡œ ì „í™˜ (1-2ì´ˆ ì†Œìš”)                   â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  14. Post-Deployment Monitoring (5-10ë¶„)                             â”‚    â”‚
â”‚  â”‚      â”œâ”€ Error Rate < 1% í™•ì¸                                         â”‚    â”‚
â”‚  â”‚      â”œâ”€ Response Time ì •ìƒ ë²”ìœ„ í™•ì¸                                 â”‚    â”‚
â”‚  â”‚      â”œâ”€ CPU/Memory ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§                                   â”‚    â”‚
â”‚  â”‚      â””â”€ Business Metrics í™•ì¸ (ì£¼ë¬¸ ì„±ê³µë¥  ë“±)                       â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  15. Rollback Decision Point                                         â”‚    â”‚
â”‚  â”‚      â”Œâ”€ ë¬¸ì œ ê°ì§€? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚    â”‚
â”‚  â”‚      â”‚                      â”‚                                        â”‚    â”‚
â”‚  â”‚      YES â”€â†’ Rollback        NO â”€â†’ Continue                          â”‚    â”‚
â”‚  â”‚      â”‚                      â”‚                                        â”‚    â”‚
â”‚  â”‚      â–¼                      â–¼                                        â”‚    â”‚
â”‚  â”‚   Blueë¡œ ë³µê·€          Green ì•ˆì •í™”                                  â”‚    â”‚
â”‚  â”‚   (1-2ì´ˆ ì†Œìš”)         (24ì‹œê°„ ìœ ì§€)                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Phase 5: ì •ë¦¬ (Green ì•ˆì •í™” í™•ì¸ í›„)                                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  16. Delete Blue Deployment (24ì‹œê°„ í›„)                              â”‚    â”‚
â”‚  â”‚      $ kubectl delete deployment customer-api-blue -n ecommerce      â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  17. Rename Green â†’ Blue (ë‹¤ìŒ ë°°í¬ ì¤€ë¹„)                            â”‚    â”‚
â”‚  â”‚      - Green Deployment â†’ Blue Deployment                            â”‚    â”‚
â”‚  â”‚      - Greenì´ ìƒˆë¡œìš´ Blueê°€ ë¨                                      â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  18. Update DestinationRule Subsets                                  â”‚    â”‚
â”‚  â”‚      - blue subset: version=v1.1.0 (ê¸°ì¡´ Green)                     â”‚    â”‚
â”‚  â”‚      - green subset: (ë‹¤ìŒ ë°°í¬ ëŒ€ê¸°)                                â”‚    â”‚
â”‚  â”‚      â”‚                                                               â”‚    â”‚
â”‚  â”‚      â–¼                                                               â”‚    â”‚
â”‚  â”‚  19. Notification                                                    â”‚    â”‚
â”‚  â”‚      ğŸ“¢ Slack: "customer-api v1.1.0 ë°°í¬ ì™„ë£Œ"                        â”‚    â”‚
â”‚  â”‚      ğŸ“Š Report: ë°°í¬ ì†Œìš” ì‹œê°„, ì—ëŸ¬ìœ¨, ë¡¤ë°± ì—¬ë¶€                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CD ì£¼ìš” ë‹¨ê³„ ìƒì„¸

#### Phase 1: Build & Test (10-15ë¶„)
- **ëª©ì **: ì½”ë“œ í’ˆì§ˆ ë³´ì¥ ë° ì´ë¯¸ì§€ ë¹Œë“œ
- **ìë™í™”**: ì™„ì „ ìë™
- **ì‹¤íŒ¨ ì‹œ**: íŒŒì´í”„ë¼ì¸ ì¤‘ë‹¨, ë°°í¬ ì—†ìŒ

#### Phase 2: Green ë°°í¬ (5ë¶„)
- **ëª©ì **: ì‹ ê·œ ë²„ì „ ë°°í¬ (íŠ¸ë˜í”½ ì „í™˜ ì „)
- **ìë™í™”**: ì™„ì „ ìë™
- **Blue ì˜í–¥**: ì—†ìŒ (BlueëŠ” ê³„ì† ìš´ì˜)

#### Phase 3: Green ê²€ì¦ (10-30ë¶„)
- **ëª©ì **: Green í™˜ê²½ ì¶©ë¶„íˆ í…ŒìŠ¤íŠ¸
- **ìë™í™”**: Smoke Test ìë™, Manual Approval ì„ íƒ
- **íŠ¸ë˜í”½**: Blue 100% (ë³€ê²½ ì—†ìŒ)

#### Phase 4: íŠ¸ë˜í”½ ì „í™˜ (1-2ì´ˆ)
- **ëª©ì **: Blue â†’ Green ì¦‰ì‹œ ì „í™˜
- **ìë™í™”**: ì™„ì „ ìë™
- **ëª¨ë‹ˆí„°ë§**: 5-10ë¶„ê°„ ì‹¤ì‹œê°„ ê°ì‹œ
- **ë¡¤ë°±**: ë¬¸ì œ ì‹œ ì¦‰ì‹œ Blue ë³µê·€

#### Phase 5: ì •ë¦¬ (24ì‹œê°„ í›„)
- **ëª©ì **: Blue í™˜ê²½ ì œê±°, ë¦¬ì†ŒìŠ¤ ì ˆì•½
- **ìë™í™”**: Manual Trigger ë˜ëŠ” Schedule
- **ì•ˆì „ì¥ì¹˜**: Green 24ì‹œê°„ ì•ˆì • í›„ ì‹¤í–‰

### GitHub Actions Workflow ì˜ˆì‹œ

```yaml
name: Blue/Green Deployment

on:
  push:
    branches:
      - main

env:
  AWS_REGION: ap-northeast-2
  ECR_REGISTRY: xxx.dkr.ecr.ap-northeast-2.amazonaws.com
  SERVICE_NAME: customer-api
  NAMESPACE: ecommerce

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run tests
        run: |
          ./gradlew test
          ./gradlew integrationTest

      - name: Build Docker image
        run: |
          docker build -t $SERVICE_NAME:${{ github.sha }} .
          docker tag $SERVICE_NAME:${{ github.sha }} $SERVICE_NAME:v1.1.0

      - name: Security scan
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: $SERVICE_NAME:${{ github.sha }}
          exit-code: '1'
          severity: 'CRITICAL,HIGH'

      - name: Push to ECR
        run: |
          aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin $ECR_REGISTRY
          docker tag $SERVICE_NAME:v1.1.0 $ECR_REGISTRY/$SERVICE_NAME:v1.1.0
          docker push $ECR_REGISTRY/$SERVICE_NAME:v1.1.0

  deploy-green:
    needs: build-and-test
    runs-on: ubuntu-latest
    steps:
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Update kubeconfig
        run: |
          aws eks update-kubeconfig --name c4ang-production --region $AWS_REGION

      - name: Deploy Green environment
        run: |
          helm upgrade $SERVICE_NAME-green ./helm/services/$SERVICE_NAME \
            --install \
            --namespace $NAMESPACE \
            --set image.tag=v1.1.0 \
            --set labels.version=v1.1.0 \
            --set fullnameOverride=$SERVICE_NAME-green \
            --wait --timeout 5m

      - name: Wait for Green pods ready
        run: |
          kubectl wait --for=condition=ready pod \
            -l app=$SERVICE_NAME,version=v1.1.0 \
            -n $NAMESPACE \
            --timeout=5m

  test-green:
    needs: deploy-green
    runs-on: ubuntu-latest
    steps:
      - name: Smoke tests on Green
        run: |
          # Health check
          kubectl exec -n $NAMESPACE deploy/$SERVICE_NAME-green -- curl -f http://localhost:8080/actuator/health
          
          # Integration tests
          ./scripts/run-integration-tests.sh --target green

      - name: Manual approval
        uses: trstringer/manual-approval@v1
        with:
          secret: ${{ secrets.GITHUB_TOKEN }}
          approvers: devops-team
          minimum-approvals: 1
          issue-title: "Approve Green deployment for ${{ env.SERVICE_NAME }}"

  switch-traffic:
    needs: test-green
    runs-on: ubuntu-latest
    steps:
      - name: Switch traffic to Green
        run: |
          kubectl patch virtualservice $SERVICE_NAME-vs -n $NAMESPACE --type merge -p '
          {
            "spec": {
              "http": [{
                "route": [
                  {"destination": {"host": "'$SERVICE_NAME'", "subset": "blue"}, "weight": 0},
                  {"destination": {"host": "'$SERVICE_NAME'", "subset": "green"}, "weight": 100}
                ]
              }]
            }
          }'
          
          echo "âœ… Traffic switched to Green (100%)"

      - name: Monitor Green environment
        run: |
          # 5ë¶„ê°„ ëª¨ë‹ˆí„°ë§
          ./scripts/monitor-deployment.sh --duration 5m --max-error-rate 1%

      - name: Rollback if needed
        if: failure()
        run: |
          echo "âŒ Problems detected, rolling back to Blue"
          kubectl patch virtualservice $SERVICE_NAME-vs -n $NAMESPACE --type merge -p '
          {
            "spec": {
              "http": [{
                "route": [
                  {"destination": {"host": "'$SERVICE_NAME'", "subset": "blue"}, "weight": 100},
                  {"destination": {"host": "'$SERVICE_NAME'", "subset": "green"}, "weight": 0}
                ]
              }]
            }
          }'

      - name: Notify deployment result
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: |
            ${{ env.SERVICE_NAME }} v1.1.0 deployment: ${{ job.status }}
            Duration: ${{ steps.switch.outputs.duration }}
            Error Rate: ${{ steps.monitor.outputs.error_rate }}
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}

  cleanup-blue:
    needs: switch-traffic
    runs-on: ubuntu-latest
    # 24ì‹œê°„ í›„ ì‹¤í–‰ (manual trigger ë˜ëŠ” schedule)
    if: github.event_name == 'workflow_dispatch'
    steps:
      - name: Delete Blue deployment
        run: |
          kubectl delete deployment $SERVICE_NAME-blue -n $NAMESPACE
          echo "ğŸ—‘ï¸  Blue deployment deleted"

      - name: Rename Green to Blue
        run: |
          # ë‹¤ìŒ ë°°í¬ë¥¼ ìœ„í•œ ì¤€ë¹„
          kubectl patch deployment $SERVICE_NAME-green -n $NAMESPACE --type merge -p '
          {
            "metadata": {"name": "'$SERVICE_NAME'-blue"}
          }'
```

### ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼

**ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ:**
- HTTP ì—ëŸ¬ìœ¨ (target: < 1%)
- Response Time P95 (target: < 500ms)
- Pod CPU/Memory ì‚¬ìš©ë¥ 
- Database Connection Pool
- Redis Cache Hit Rate

**ì•Œë¦¼ ì±„ë„:**
- Slack (#deployments ì±„ë„)
- PagerDuty (Critical ì´ìŠˆ)
- Email (ë°°í¬ ì™„ë£Œ ë¦¬í¬íŠ¸)

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

### ë‚´ë¶€ ë¬¸ì„œ
- [EKS-ISTIO-DEPLOYMENT-SUMMARY.md](./EKS-ISTIO-DEPLOYMENT-SUMMARY.md) - ë°°í¬ ì™„ë£Œ ë³´ê³ ì„œ
- [EKS-ISTIO-TEST-REPORT.md](./EKS-ISTIO-TEST-REPORT.md) - í…ŒìŠ¤íŠ¸ ì™„ë£Œ ë³´ê³ ì„œ
- [helm/services/README.md](../helm/services/README.md) - Helm Charts ê°€ì´ë“œ
- [k8s-eks/README-AIRFLOW.md](../k8s-eks/README-AIRFLOW.md) - Airflow ë°°í¬ ê°€ì´ë“œ

### ì™¸ë¶€ ìë£Œ
- [Kubernetes ê³µì‹ ë¬¸ì„œ](https://kubernetes.io/docs/)
- [Istio ê³µì‹ ë¬¸ì„œ](https://istio.io/latest/docs/)
- [Apache Airflow ê³µì‹ ë¬¸ì„œ](https://airflow.apache.org/docs/)
- [AWS EKS ëª¨ë²” ì‚¬ë¡€](https://aws.github.io/aws-eks-best-practices/)
- [ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ íŒ¨í„´](https://microservices.io/patterns/)

---

**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-17  
**ì‘ì„±ì**: DevOps Team  
**ë¬¸ì˜**: ì¸í”„ë¼ íŒ€


