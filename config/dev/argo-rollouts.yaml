# k3d ê°œë°œ í™˜ê²½ Argo Rollouts ì„¤ì •

namespace: argo-rollouts

argo-rollouts:
  controller:
    replicas: 1
    metrics:
      enabled: true
      serviceMonitor:
        enabled: false

  dashboard:
    enabled: true
    service:
      type: ClusterIP
      port: 3100

  installCRDs: true

  notifications:
    secret:
      create: true
    # webhook ì„œë¹„ìŠ¤ ì„¤ì • (controllerê°€ ì¸ì‹í•˜ë„ë¡)
    notifiers:
      service.webhook.discord: |
        url: https://discord.com/api/webhooks/1447770723887222855/H8QUSS2p9ZZrApzbhlsdFyjSuhFIjQUiNshZFRrnKUextrP9H2JYsl8arBLOjNmj8bBC
        headers:
        - name: Content-Type
          value: application/json
    # í…œí”Œë¦¿ ì •ì˜ - Discord Embed
    templates:
      template.rollout-completed: |
        webhook:
          discord:
            method: POST
            body: |
              {"embeds":[{"title":"âœ… ë°°í¬ ì™„ë£Œ","color":3066993,"fields":[{"name":"ì„œë¹„ìŠ¤","value":"{{.rollout.metadata.name}}","inline":true},{"name":"ë„¤ì„ìŠ¤í˜ì´ìŠ¤","value":"{{.rollout.metadata.namespace}}","inline":true},{"name":"ë²„ì „","value":"{{.rollout.status.currentPodHash}}","inline":true}],"description":"Pre/Post Analysisë¥¼ í†µê³¼í•˜ì—¬ ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."}]}
      template.rollout-aborted: |
        webhook:
          discord:
            method: POST
            body: |
              {"embeds":[{"title":"ğŸš¨ ìë™ ë¡¤ë°± ë°œìƒ","color":15158332,"fields":[{"name":"ì„œë¹„ìŠ¤","value":"{{.rollout.metadata.name}}","inline":true},{"name":"ë„¤ì„ìŠ¤í˜ì´ìŠ¤","value":"{{.rollout.metadata.namespace}}","inline":true},{"name":"ì‚¬ìœ ","value":"{{.rollout.status.message}}","inline":false}],"description":"PostPromotionAnalysis ì‹¤íŒ¨ë¡œ ìë™ ë¡¤ë°±ë˜ì—ˆìŠµë‹ˆë‹¤."}]}
    # íŠ¸ë¦¬ê±° ì •ì˜
    triggers:
      trigger.on-rollout-completed: |
        - send: [rollout-completed]
          when: rollout.status.phase == 'Healthy'
      trigger.on-rollout-aborted: |
        - send: [rollout-aborted]
          when: rollout.status.phase == 'Degraded'

# ê°œë°œ í™˜ê²½ ëª¨ë‹ˆí„°ë§ ì„¤ì •
metrics:
  enabled: true
  port: 8090
  targetPort: 8090

prometheus:
  enabled: true
  scrape: true
  path: /metrics
  port: 8090
