# AWS 비용 절감 계획 (2025-12-08)

## 개요
- **기간**: 2025-12-08 ~ 2025-12-12 (5일간)
- **목적**: 금요일까지 운영 비용 최소화
- **환율 기준**: $1 = ₩1,400

---

## Before (최적화 전)

### EKS 노드 그룹
| 노드 그룹 | 인스턴스 타입 | 수량 | 시간당 비용 | 5일 비용 |
|-----------|--------------|------|------------|----------|
| core-on | t3.large | 2 | $0.208 | $24.96 |
| high-traffic | t3.large | 2 | $0.208 | $24.96 |
| low-traffic | t3.medium | 2 | $0.104 | $12.48 |
| stateful-storage | m5.large | 2 | $0.236 | $28.32 |
| kafka-storage | m5.large | 3 | $0.354 | $42.48 |
| **EC2 소계** | | **11개** | **$1.11** | **$133.20** |

### RDS 인스턴스
| 인스턴스 | 타입 | 시간당 비용 | 5일 비용 |
|----------|------|------------|----------|
| c4-app-db | db.r6g.large | $0.292 | $35.04 |
| c4-customer-db | db.t3.micro | $0.023 | $2.76 |
| c4-order-db | db.t3.micro | $0.023 | $2.76 |
| c4-payment-db | db.t3.micro | $0.023 | $2.76 |
| c4-product-db | db.t3.micro | $0.023 | $2.76 |
| c4-saga-db | db.t3.micro | $0.023 | $2.76 |
| c4-store-db | db.t3.micro | $0.023 | $2.76 |
| **RDS 소계** | | **$0.43** | **$51.60** |

### 서비스 Replica
| 서비스 | Replica 수 |
|--------|-----------|
| customer-api | 3 |
| store-api | 2 |
| product-api | 3 |
| order-api | 3 |
| payment-api | 3 |
| saga-tracker-api | 3 |
| **총 Pod 수** | **17** |

### 기타 서비스
| 서비스 | 사양 | 5일 비용 |
|--------|------|----------|
| MSK (Kafka) | kafka.m5.large x 3 | $75.60 |
| ElastiCache | cache.t3.micro x 2 | $4.08 |
| NAT Gateway | 1개 | $7.08 |
| NLB | 9개 | $29.16 |
| 스토리지 (EBS/RDS) | | $12.49 |
| 기타 (S3, CloudWatch) | | $8.50 |
| **기타 소계** | | **$136.91** |

### Before 총 비용
| 항목 | 5일 비용 |
|------|----------|
| EC2 (EKS 노드) | $133.20 |
| RDS | $51.60 |
| 기타 | $136.91 |
| **합계** | **$321.71** |
| **한화 (₩1,400)** | **약 ₩450,400** |

---

## 절감 계획 및 이유

### 1. RDS c4-app-db 다운그레이드
- **변경**: `db.r6g.large` → `db.t3.micro`
- **이유**:
  - c4-app-db는 도메인별 RDS (customer-db, order-db 등) 도입 후 거의 사용되지 않음
  - 실제 트래픽이 없는 상태에서 r6g.large는 과도한 사양
- **절감**: $35.04 → $2.76 = **$32.28 절감**

### 2. EKS kafka-storage 노드 그룹 0으로 축소
- **변경**: m5.large x 3 → 0개
- **이유**:
  - AWS MSK (관리형 Kafka)를 사용하므로 자체 Kafka 노드 불필요
  - 노드에 시스템 데몬셋만 실행 중 (CPU 1%, Memory 7%)
  - 완전한 리소스 낭비
- **절감**: **$42.48 절감**

### 3. EKS stateful-storage 노드 그룹 0으로 축소
- **변경**: m5.large x 2 → 0개
- **이유**:
  - ElastiCache Redis 사용으로 자체 stateful 워크로드 없음
  - 노드에 시스템 데몬셋만 실행 중 (CPU 1%, Memory 7%)
- **절감**: **$28.32 절감**

### 4. 서비스 Replica 축소
- **변경**:
  - customer-api: 3 → 2
  - product-api: 3 → 2
  - order-api: 3 → 2
  - payment-api: 3 → 2
  - saga-tracker-api: 3 → 1
- **이유**:
  - 현재 실제 트래픽 없음 (테스트/데모 단계)
  - 고가용성보다 비용 효율성 우선
  - 필요시 autoscaling으로 자동 확장
- **절감**: Pod 수 17 → 11개로 감소 (노드 리소스 여유 확보)

---

## After (최적화 후 예상)

### EKS 노드 그룹
| 노드 그룹 | 인스턴스 타입 | 수량 | 시간당 비용 | 5일 비용 |
|-----------|--------------|------|------------|----------|
| core-on | t3.large | 2 | $0.208 | $24.96 |
| high-traffic | t3.large | 2 | $0.208 | $24.96 |
| low-traffic | t3.medium | 2 | $0.104 | $12.48 |
| stateful-storage | m5.large | **0** | $0 | **$0** |
| kafka-storage | m5.large | **0** | $0 | **$0** |
| **EC2 소계** | | **6개** | **$0.52** | **$62.40** |

### RDS 인스턴스
| 인스턴스 | 타입 | 시간당 비용 | 5일 비용 |
|----------|------|------------|----------|
| c4-app-db | **db.t3.micro** | **$0.023** | **$2.76** |
| c4-customer-db | db.t3.micro | $0.023 | $2.76 |
| c4-order-db | db.t3.micro | $0.023 | $2.76 |
| c4-payment-db | db.t3.micro | $0.023 | $2.76 |
| c4-product-db | db.t3.micro | $0.023 | $2.76 |
| c4-saga-db | db.t3.micro | $0.023 | $2.76 |
| c4-store-db | db.t3.micro | $0.023 | $2.76 |
| **RDS 소계** | | **$0.161** | **$19.32** |

### 서비스 Replica
| 서비스 | Replica 수 |
|--------|-----------|
| customer-api | **2** |
| store-api | 2 |
| product-api | **2** |
| order-api | **2** |
| payment-api | **2** |
| saga-tracker-api | **1** |
| **총 Pod 수** | **11** |

### 기타 서비스 (변경 없음)
| 서비스 | 5일 비용 |
|--------|----------|
| MSK (Kafka) | $75.60 |
| ElastiCache | $4.08 |
| NAT Gateway | $7.08 |
| NLB | $29.16 |
| 스토리지 (EBS/RDS) | $10.00 (감소) |
| 기타 | $8.50 |
| **기타 소계** | **$134.42** |

### After 총 비용
| 항목 | 5일 비용 |
|------|----------|
| EC2 (EKS 노드) | $62.40 |
| RDS | $19.32 |
| 기타 | $134.42 |
| **합계** | **$216.14** |
| **한화 (₩1,400)** | **약 ₩302,600** |

---

## 절감 요약

| 항목 | Before | After | 절감액 |
|------|--------|-------|--------|
| EC2 (EKS 노드) | $133.20 | $62.40 | **$70.80** |
| RDS | $51.60 | $19.32 | **$32.28** |
| 기타 | $136.91 | $134.42 | $2.49 |
| **합계** | **$321.71** | **$216.14** | **$105.57** |

### 총 절감
- **절감액**: $105.57 (약 ₩147,800)
- **절감률**: 32.8%
- **최종 예상 비용**: $216.14 (약 ₩302,600)

---

## 실행 내역

### 완료된 작업
- [x] RDS c4-app-db: db.r6g.large → db.t3.micro (진행 중, 몇 분 소요)
- [x] kafka-storage 노드 그룹: 3 → 0 (진행 중)
- [x] stateful-storage 노드 그룹: 2 → 0 (진행 중)
- [x] 서비스 replica 설정 변경 (Git push 완료)

### ArgoCD 자동 동기화
- 서비스 replica 변경은 ArgoCD가 자동으로 적용

---

## 추가 절감 가능 항목 (향후 검토)

| 항목 | 현재 | 가능한 변경 | 예상 절감 |
|------|------|------------|----------|
| core-on | t3.large x 2 | x 1 | $12.48 |
| high-traffic | t3.large x 2 | x 1 | $12.48 |
| low-traffic | t3.medium x 2 | x 1 | $6.24 |
| NLB | 9개 | 정리 필요 | ~$15 |

**주의**: 노드 추가 축소 시 Pod 스케줄링 실패 가능성 있으므로 replica 축소 적용 후 모니터링 필요

---

## 비고
- 문서 작성일: 2025-12-08
- 작성자: Claude Code
- 관련 커밋: c92fbaf (chore: reduce service replicas for cost optimization)
