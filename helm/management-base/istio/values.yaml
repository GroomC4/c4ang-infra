# Istio Configuration - 환경 중립적 기본값
# 이 파일은 공통 기본값만 정의합니다.
# 환경별 설정은 k8s-dev-k3d/values/ 또는 k8s-eks/values/에서 오버라이드하세요.

# CRD 설치 설정
crds:
  install: false
  gatewayAPI:
    install: false
    version: "v1.0.0"

# Namespace 설정
namespace:
  name: ecommerce
  create: true
  istioInjection: enabled

# Gateway 설정
gateway:
  main:
    enabled: true
    name: ecommerce-gateway
    hostname: ""  # 환경별로 오버라이드
    annotations: {}  # 환경별로 오버라이드 (AWS NLB 등)
    listeners:
      https:
        enabled: true
        port: 443
        tls:
          mode: Terminate
          certificateRefs:
            - name: ecommerce-tls-cert
              kind: Secret
      http:
        enabled: true
        port: 80
        redirectToHttps: true

  webhook:
    enabled: false  # 환경별로 활성화
    name: webhook-gateway
    hostname: ""
    annotations: {}
    listeners:
      https:
        enabled: true
        port: 443
        tls:
          mode: Terminate
          certificateRefs:
            - name: webhook-tls-cert
              kind: Secret

# Security 설정
security:
  mTLS:
    enabled: true
    mode: STRICT

  jwt:
    enabled: false  # 환경별로 활성화
    issuer: ""
    jwksUri: ""
    audiences: []

  webhook:
    ipWhitelist: []

  publicEndpoints:
    - /api/v1/auth/customers/signup
    - /api/v1/auth/customers/login
    - /api/v1/auth/owners/signup
    - /api/v1/auth/owners/login
    - /api/v1/auth/refresh
    - /actuator/health
    - /actuator/prometheus

# HTTPRoute 설정
httpRoute:
  enabled: true
  services:
    order:
      enabled: false
      path: /api/v1/orders
      serviceName: order-service
      servicePort: 8080
    product:
      enabled: false
      path: /api/v1/products
      serviceName: product-service
      servicePort: 8080
    payment:
      enabled: false
      path: /api/v1/payments
      serviceName: payment-service
      servicePort: 8080
    user:
      enabled: false
      path: /api/v1/users
      serviceName: user-service
      servicePort: 8080
    auth:
      enabled: false
      path: /api/v1/auth
      serviceName: auth-service
      servicePort: 8080
    store:
      enabled: false
      path: /api/v1/stores
      serviceName: store-service
      servicePort: 8080
    review:
      enabled: false
      path: /api/v1/reviews
      serviceName: review-service
      servicePort: 8080
    recommendation:
      enabled: false
      path: /api/v1/recommendations
      serviceName: recommendation-service
      servicePort: 8080
    analytics:
      enabled: false
      path: /api/v1/analytics
      serviceName: analytics-service
      servicePort: 8080

# Traffic Management 설정
trafficManagement:
  destinationRules:
    enabled: false
    circuitBreaker:
      enabled: false
      consecutive5xxErrors: 5
      interval: 10s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
      minHealthPercent: 40

  virtualServices:
    enabled: false
    retries:
      attempts: 3
      perTryTimeout: 5s
      timeout: 5s

# EnvoyFilter 설정
envoyFilter:
  rateLimit:
    enabled: false
    redis:
      host: redis.ecommerce.svc.cluster.local
      port: 6379
    limits:
      user: 100
      ip: 50

  tokenBlacklist:
    enabled: false
    redis:
      host: redis.ecommerce.svc.cluster.local
      port: 6379

# Gateway API
gatewayAPI:
  enabled: false
  version: "v1.0.0"
