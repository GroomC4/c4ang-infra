# K3D Local Development Values for Monitoring Stack
# 로컬 개발 환경을 위한 경량화된 모니터링 설정

# Namespace
namespace: monitoring

# Image Pull Secrets (로컬에서는 불필요)
imagePullSecrets: []

# Grafana Alloy DaemonSet settings
alloy:
  enabled: true  # 로컬에서도 활성화하되 설정 간소화
  image:
    repository: grafana/alloy
    tag: v1.0.0
    pullPolicy: IfNotPresent
  
  # 로컬 환경을 위한 낮은 리소스 사용량
  resources:
    limits:
      cpu: "200m"
      memory: "256Mi"
    requests:
      cpu: "100m"
      memory: "128Mi"
  
  # RBAC 설정
  rbac:
    create: true
  
  # DaemonSet 설정
  daemonset:
    nodeSelector: {}
    tolerations: []
    affinity: {}
  
  # k3d 환경에 맞는 간소화된 수집 설정
  config:
    # k3d 환경에서 machine-id 마운트 건너뛰기
    skipMachineId: true
    
    logs:
      enabled: true
      paths:
        - /var/log/pods/*/*/*.log
    
    metrics:
      enabled: true
      scrapeInterval: 60s  # 로컬에서는 덜 빈번하게
    
    traces:
      enabled: false  # 로컬에서는 트레이스 비활성화로 리소스 절약
      otlpHttpPort: 4318
      otlpGrpcPort: 4317

# Prometheus settings (경량화)
prometheus:
  enabled: true
  image:
    repository: prom/prometheus
    tag: v2.50.0
    pullPolicy: IfNotPresent
  
  replicas: 1
  
  # 로컬 환경용 작은 스토리지
  storage:
    size: 10Gi  # 50Gi → 10Gi로 축소
    storageClassName: ""
  
  # 짧은 보존 기간
  retention:
    time: 7d    # 30d → 7d로 축소
    size: 8GB   # 45GB → 8GB로 축소
  
  # 낮은 리소스 사용량
  resources:
    limits:
      cpu: "500m"
      memory: "1Gi"
    requests:
      cpu: "200m"
      memory: "512Mi"
  
  service:
    type: ClusterIP
    port: 9090
  
  # 로컬 환경용 간소화된 스크랩 설정
  scrapeConfigs:
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
        - role: pod

# Loki settings (경량화)
loki:
  enabled: true
  image:
    repository: grafana/loki
    tag: 2.9.4
    pullPolicy: IfNotPresent
  
  replicas: 1
  
  # 작은 스토리지
  storage:
    size: 5Gi   # 20Gi → 5Gi로 축소
    storageClassName: ""
  
  # 짧은 로그 보존 기간
  retention:
    enabled: true
    period: 7d  # 90d → 7d로 축소
  
  # 낮은 리소스 사용량
  resources:
    limits:
      cpu: "300m"
      memory: "512Mi"
    requests:
      cpu: "100m"
      memory: "256Mi"
  
  service:
    type: ClusterIP
    port: 3100
  
  # 로그 제한 설정 (관대하게)
  limits:
    maxStreams: 5000     # 10000 → 5000으로 축소
    ingestionRateMb: 20  # 10 → 20으로 증가 (로컬 테스트용)
    ingestionBurstSizeMb: 40  # 20 → 40으로 증가

# Tempo settings (비활성화 또는 경량화)
tempo:
  enabled: false  # 로컬에서는 트레이싱 비활성화로 리소스 절약

# Grafana settings (로컬 친화적)
grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: 10.3.1
    pullPolicy: IfNotPresent
  
  replicas: 1
  
  # 관리자 계정
  admin:
    user: admin
    password: "admin"  # 로컬 개발용
    existingSecret: ""
    secretKey: "admin-password"
  
  # 작은 스토리지
  storage:
    size: 2Gi  # 5Gi → 2Gi로 축소
    storageClassName: ""
  
  # 낮은 리소스 사용량
  resources:
    limits:
      cpu: "200m"
      memory: "256Mi"
    requests:
      cpu: "100m"
      memory: "128Mi"
  
  service:
    type: ClusterIP
    port: 3000
  
  # 대시보드 활성화
  dashboards:
    enabled: true
  
  # 기본 데이터소스만 활성화
  datasources:
    prometheus:
      enabled: true
      url: http://prometheus:9090
      isDefault: true
    
    loki:
      enabled: true
      url: http://loki:3100
    
    tempo:
      enabled: false  # Tempo 비활성화했으므로

# Alerting 비활성화 (로컬에서 불필요)
alerting:
  enabled: false

# ServiceMonitor 비활성화
serviceMonitor:
  enabled: false

# Ingress 비활성화 (로컬에서는 포트포워드 사용)
ingress:
  enabled: false

# 로컬 환경용 공통 설정
nodeSelector: {}
tolerations: []
affinity: {}