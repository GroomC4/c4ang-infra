# Monitoring Stack - 환경 중립적 기본값
# 이 파일은 공통 기본값만 정의합니다.
# 환경별 설정은 k8s-dev-k3d/values/ 또는 k8s-eks/values/에서 오버라이드하세요.

namespace: monitoring

# Image Pull Secrets
imagePullSecrets: []

# Grafana Alloy DaemonSet (메트릭, 로그, 트레이스 수집 에이전트)
alloy:
  enabled: true
  image:
    repository: grafana/alloy
    tag: v1.0.0
    pullPolicy: IfNotPresent

  resources:
    limits:
      cpu: "500m"
      memory: "512Mi"
    requests:
      cpu: "200m"
      memory: "256Mi"

  rbac:
    create: true

  daemonset:
    nodeSelector: {}
    tolerations: []
    affinity: {}

  config:
    logs:
      enabled: true
      paths:
        - /var/log/pods/*/*/*.log
    metrics:
      enabled: true
      scrapeInterval: 30s
    traces:
      enabled: true
      otlpHttpPort: 4318
      otlpGrpcPort: 4317

# Prometheus (메트릭 저장소)
prometheus:
  enabled: true
  image:
    repository: prom/prometheus
    tag: v2.50.0
    pullPolicy: IfNotPresent

  replicas: 1

  storage:
    size: 50Gi
    storageClassName: ""  # 환경별로 오버라이드

  retention:
    time: 30d
    size: 45GB

  resources:
    limits:
      cpu: "1000m"
      memory: "2Gi"
    requests:
      cpu: "500m"
      memory: "1Gi"

  service:
    type: ClusterIP
    port: 9090

  scrapeConfigs:
    - job_name: 'kubernetes-apiservers'
      kubernetes_sd_configs:
        - role: endpoints
    - job_name: 'kubernetes-nodes'
      kubernetes_sd_configs:
        - role: node
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
        - role: pod

# Loki (로그 저장소)
loki:
  enabled: true
  image:
    repository: grafana/loki
    tag: 2.9.4
    pullPolicy: IfNotPresent

  replicas: 1

  storage:
    size: 20Gi
    storageClassName: ""

  retention:
    enabled: true
    period: 90d

  resources:
    limits:
      cpu: "1000m"
      memory: "1Gi"
    requests:
      cpu: "500m"
      memory: "512Mi"

  service:
    type: ClusterIP
    port: 3100

  limits:
    maxStreams: 10000
    ingestionRateMb: 10
    ingestionBurstSizeMb: 20

# Tempo (트레이스 저장소)
tempo:
  enabled: true
  image:
    repository: grafana/tempo
    tag: 2.3.1
    pullPolicy: IfNotPresent

  replicas: 1

  storage:
    size: 20Gi
    storageClassName: ""

  retention:
    period: 720h  # 30일

  resources:
    limits:
      cpu: "1000m"
      memory: "1Gi"
    requests:
      cpu: "500m"
      memory: "512Mi"

  service:
    type: ClusterIP
    otlpGrpcPort: 4317
    otlpHttpPort: 4318
    tempoPort: 3200

  sampling:
    rate: 0.1

# Grafana (시각화 대시보드)
grafana:
  enabled: true
  image:
    repository: grafana/grafana
    tag: 10.3.1
    pullPolicy: IfNotPresent

  replicas: 1

  admin:
    user: admin
    password: ""  # 환경별로 오버라이드 필수
    existingSecret: ""
    secretKey: "admin-password"

  storage:
    size: 5Gi
    storageClassName: ""

  resources:
    limits:
      cpu: "500m"
      memory: "512Mi"
    requests:
      cpu: "250m"
      memory: "256Mi"

  service:
    type: ClusterIP
    port: 3000

  dashboards:
    enabled: true

  datasources:
    prometheus:
      enabled: true
      url: http://prometheus:9090
      isDefault: true
    loki:
      enabled: true
      url: http://loki:3100
    tempo:
      enabled: true
      url: http://tempo:3200

# Alerting
alerting:
  enabled: false  # 환경별로 활성화
  slack:
    enabled: false
    webhookUrl: ""
    channel: "#alerts"
  email:
    enabled: false
    from: ""
    to: ""
    smtpHost: ""
    smtpUser: ""
    smtpPassword: ""
  rules: []

# ServiceMonitor (Prometheus Operator 사용 시)
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s

# Ingress
ingress:
  enabled: false
  className: ""
  annotations: {}
  grafana:
    host: ""
    tls:
      enabled: false
      secretName: ""
  prometheus:
    host: ""
    tls:
      enabled: false
      secretName: ""

# 공통 노드 설정
nodeSelector: {}
tolerations: []
affinity: {}
