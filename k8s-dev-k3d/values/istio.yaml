# Istio Configuration - k3d 로컬/테스트 환경 설정
# 기본값: helm/management-base/istio/values.yaml

# Namespace
namespace:
  name: ecommerce
  create: false  # install-istio.sh 스크립트가 생성

# Gateway 설정 - k3d 환경용
gateway:
  main:
    enabled: true
    name: ecommerce-gateway
    hostname: api.ecommerce.local
    # k3d에서는 AWS NLB 어노테이션 불필요
    annotations: {}
    listeners:
      https:
        enabled: false  # 로컬에서는 HTTP만 사용
      http:
        enabled: true
        port: 80
        redirectToHttps: false

  webhook:
    enabled: false  # 로컬에서는 비활성화

# Security 설정 - 로컬 테스트용
security:
  mTLS:
    enabled: true
    mode: PERMISSIVE  # 로컬에서는 PERMISSIVE로 테스트 용이

  jwt:
    enabled: false  # 로컬에서는 비활성화

  publicEndpoints:
    - /api/v1/auth/customers/signup
    - /api/v1/auth/customers/login
    - /api/v1/auth/owners/signup
    - /api/v1/auth/owners/login
    - /api/v1/auth/refresh
    - /actuator/health
    - /actuator/prometheus

# HTTPRoute - 필요한 서비스만 활성화
httpRoute:
  enabled: true
  services:
    order:
      enabled: false
      path: /api/v1/orders
      serviceName: order-service
      servicePort: 8080
    product:
      enabled: false
      path: /api/v1/products
      serviceName: product-service
      servicePort: 8080
    payment:
      enabled: false
      path: /api/v1/payments
      serviceName: payment-service
      servicePort: 8080
    user:
      enabled: false
      path: /api/v1/users
      serviceName: user-service
      servicePort: 8080
    auth:
      enabled: false
      path: /api/v1/auth
      serviceName: auth-service
      servicePort: 8080
    store:
      enabled: false
      path: /api/v1/stores
      serviceName: store-service
      servicePort: 8080
    review:
      enabled: false
      path: /api/v1/reviews
      serviceName: review-service
      servicePort: 8080
    recommendation:
      enabled: false
      path: /api/v1/recommendations
      serviceName: recommendation-service
      servicePort: 8080
    analytics:
      enabled: false
      path: /api/v1/analytics
      serviceName: analytics-service
      servicePort: 8080

# Traffic Management - 로컬에서는 비활성화
trafficManagement:
  destinationRules:
    enabled: false
  virtualServices:
    enabled: false

# EnvoyFilter - 로컬에서는 비활성화
envoyFilter:
  rateLimit:
    enabled: false
  tokenBlacklist:
    enabled: false

# Gateway API
gatewayAPI:
  enabled: false
