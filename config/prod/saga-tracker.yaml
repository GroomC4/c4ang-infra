# saga-tracker EKS 프로덕션 환경 설정
# AWS RDS, ElastiCache, MSK 사용

replicaCount: 3
image:
  repository: 963403601423.dkr.ecr.ap-northeast-2.amazonaws.com/c4ang-saga-tracker
  pullPolicy: IfNotPresent
  tag: "v1.0.5"
# ECR 이미지 pull을 위한 secret
imagePullSecrets:
  - name: ecr-secret
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
resources:
  requests:
    memory: 512Mi
    cpu: 250m
  limits:
    memory: 1Gi
    cpu: 500m
# Application configuration (injected via ConfigMap)
config:
  SERVER_PORT: "8081"
  SPRING_PROFILES_ACTIVE: "prod"
  # Flyway 설정 - checksum mismatch 자동 repair
  SPRING_FLYWAY_REPAIR_ON_MIGRATE: "true"
  SPRING_FLYWAY_VALIDATE_ON_MIGRATE: "false"
  # AWS RDS PostgreSQL (ExternalName 서비스를 통한 연결)
  SPRING_DATASOURCE_URL: "jdbc:postgresql://saga-db:5432/saga_db"
  SPRING_DATASOURCE_MASTER_URL: "jdbc:postgresql://saga-db:5432/saga_db"
  SPRING_DATASOURCE_REPLICA_URL: "jdbc:postgresql://saga-db:5432/saga_db"
  # AWS MSK Kafka
  KAFKA_BOOTSTRAP_SERVERS: "b-1.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-2.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-3.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092"
  SPRING_KAFKA_BOOTSTRAP_SERVERS: "b-1.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-2.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-3.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092"
  SPRING_KAFKA_PRODUCER_BOOTSTRAP_SERVERS: "b-1.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-2.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-3.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092"
  SPRING_KAFKA_CONSUMER_BOOTSTRAP_SERVERS: "b-1.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-2.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092,b-3.c4kafka.l9hkqg.c2.kafka.ap-northeast-2.amazonaws.com:9092"
  # Schema Registry
  SCHEMA_REGISTRY_URL: "http://schema-registry.kafka.svc.cluster.local:8081"
# Sensitive data (injected via Secret) - 임시로 plaintext 사용 (차후 AWS Secrets Manager로 이관 예정)
secrets:
  SPRING_DATASOURCE_USERNAME: "appuser"
  SPRING_DATASOURCE_PASSWORD: "Airflow2025"
  SPRING_DATASOURCE_MASTER_USERNAME: "appuser"
  SPRING_DATASOURCE_MASTER_PASSWORD: "Airflow2025"
  SPRING_DATASOURCE_REPLICA_USERNAME: "appuser"
  SPRING_DATASOURCE_REPLICA_PASSWORD: "Airflow2025"
# Istio 설정 (기본값 사용)
